<link rel="stylesheet" href="/admin/content_css/blocks.css">
<div class="content-wrapper">
    <!-- Stats -->
    <div class="stats-grid">
        <div class="stat-card solid-blue">
            <div class="stat-icon blue">
                <svg width="40" height="40" fill="white">
                    <use href="/images/icons.svg#icon-buildings"></use>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">5</div>
                <div class="stat-label">Всего блоков</div>
                <div class="stat-change positive">↑ 100%</div>
            </div>
        </div>

        <div class="stat-card solid-green">
            <div class="stat-icon green">
                <svg width="40" height="40" fill="white">
                    <use href="/images/icons.svg#icon-apartments"></use>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">420</div>
                <div class="stat-label">Всего квартир</div>
                <div class="stat-change positive">↑ 25 новых</div>
            </div>
        </div>

        <div class="stat-card solid-orange">
            <div class="stat-icon orange">
                <svg width="40" height="40" fill="white">
                    <use href="/images/icons.svg#icon-users"></use>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">98%</div>
                <div class="stat-label">Заселенность</div>
                <div class="stat-change positive">↑ 5% за месяц</div>
            </div>
        </div>

        <div class="stat-card solid-red">
            <div class="stat-icon purple">
                <svg width="40" height="40" fill="white">
                    <use href="/images/icons.svg#icon-users"></use>
                </svg>
            </div>
            <div class="stat-details">
                <div class="stat-value">1,850</div>
                <div class="stat-label">Жителей</div>
                <div class="stat-change positive">↑ 12% за месяц</div>
            </div>
        </div>
    </div>

    <!-- Complex Map -->
    <div class="block-map-container">
        <div class="block-actions">
            <h2 class="mb-0 flex-grow-1">План комплекса Royal Park</h2>
            <input type="text" id="newBlockName" class="form-control" placeholder="Название нового блока">
            <button class="btn btn-success w-auto" onclick="createBlock()">
                <i class="bi bi-plus-lg"></i> Создать блок
            </button>
        </div>
        
        <div class="complex-map" id="complexMap">
            <div class="block-card" data-block="A" onclick="selectBlock('A')">
                <div class="block-name">Блок A</div>
                <div class="block-info">
                    <div>10 этажей</div>
                    <div>80 квартир</div>
                    <div>320 жителей</div>
                </div>
            </div>
            
            <div class="block-card" data-block="B" onclick="selectBlock('B')">
                <div class="block-name">Блок B</div>
                <div class="block-info">
                    <div>10 этажей</div>
                    <div>80 квартир</div>
                    <div>315 жителей</div>
                </div>
            </div>
            
            <div class="block-card" data-block="K" onclick="selectBlock('K')">
                <div class="block-name">Блок K</div>
                <div class="block-info">
                    <div>12 этажей</div>
                    <div>96 квартир</div>
                    <div>385 жителей</div>
                </div>
            </div>
            
            <div class="block-card" data-block="X" onclick="selectBlock('X')">
                <div class="block-name">Блок X</div>
                <div class="block-info">
                    <div>15 этажей</div>
                    <div>120 квартир</div>
                    <div>480 жителей</div>
                </div>
            </div>
            
            <div class="block-card" data-block="Z" onclick="selectBlock('Z')">
                <div class="block-name">Блок Z</div>
                <div class="block-info">
                    <div>8 этажей</div>
                    <div>64 квартиры</div>
                    <div>256 жителей</div>
                </div>
            </div>
        </div>
        
        <div class="complex-plan-wrapper">
            <div class="complex-plan-header">
                <div>
                    <h5 class="mb-1 text-white">План комплекса Royal Park</h5>
                </div>
                <div class="plan-legend">
                    <span data-block-code="A"><i style="background:#5ba344"></i> Блок A</span>
                    <span data-block-code="B"><i style="background:#f4c64d"></i> Блок B</span>
                    <span data-block-code="C"><i style="background:#a8577a"></i> Блок C</span>
                    <span data-block-code="D"><i style="background:#9b6a33"></i> Блок D</span>
                    <span data-block-code="E"><i style="background:#138666"></i> Блок E</span>
                    <span data-block-code="F"><i style="background:#c20b6a"></i> Блок F</span>
                    <span data-block-code="H"><i style="background:#20438a"></i> Блок H</span>
                    <span data-block-code="K"><i style="background:#4a6fbf"></i> Блок K</span>
                    <span data-block-code="X"><i style="background:#082b5c"></i> Блок X</span>
                    <span data-block-code="G3"><i style="background:#6e1600"></i> Корпус G 3</span>
                </div>
            </div>
            <div class="plan-image-frame">
                <img src="/images/edited-photo.png" alt="План комплекса Royal Park">
                <svg class="plan-overlay" viewBox="0 0 2752 1536" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
                    <polygon class="plan-area" data-block-code="X" data-block-label="Block X" data-block-info="Vusal" points="425.998 355.434 556.672 175.104 501.789 162.036 248.281 446.906 514.857 512.243 622.01 410.317 530.538 373.728"></polygon>
                    <polygon class="plan-area" data-block-code="H" data-block-label="Block H" data-block-info="Anar" points="571.62 176.184 939.65 242.743 884.837 328.878 497.231 258.404"></polygon>
                    <polygon class="plan-area" data-block-code="K" data-block-label="Block K" data-block-info="Ayaz m." points="422.842 344.538 481.571 262.319 880.922 340.623 837.855 434.588"></polygon>
                    <polygon class="plan-area" data-block-code="F" data-block-label="Block F" data-block-info="Omeritto" points="935.628 671.666 1217.88 726.549 1677.86 1233.57 1468.78 1314.58"></polygon>
                    <polygon class="plan-area" data-block-code="B" data-block-label="Block B" data-block-info="Elmar" points="1199.59 705.641 1534.12 791.886 2174.42 1416.51 1816.37 1364.24"></polygon>
                    <polygon class="plan-area" data-block-code="A" data-block-label="Block A" data-block-info="Ferid " points="1541.96 789.273 2221.46 935.628 2359.98 1042.78 2472.36 1225.72 2508.95 1489.69 2192.71 1419.12"></polygon>
                    <polygon class="plan-area" data-block-code="C" data-block-label="Block C" data-block-info="Babek m." points="1395.6 708.255 1706.61 784.046 1727.51 454.746 1541.96 415.544"></polygon>
                    <polygon class="plan-area" data-block-code="D" data-block-label="Block D" data-block-info="Ulvi" points="1743.19 454.746 1889.55 480.881 1889.55 786.659 1722.29 781.432"></polygon>
                    <polygon class="plan-area" data-block-code="E" data-block-label="Block E" data-block-info="Taleh emi" points="1607.29 436.452 1534.12 407.704 1575.93 360.661 2072.49 459.973 2111.7 880.745 2007.16 851.996 1996.7 791.886 1902.62 770.978 1900 488.722"></polygon>
                    <polygon class="plan-area" data-block-code="G3" data-block-label="Corpus G 3" data-block-info="CB" points="610.773 458.079 755.635 422.842 790.872 489.401 642.094 528.553"></polygon>
                </svg>
            </div>
            <div class="plan-note">Royal Park Baku, Yeni Yasamal, 10 Kenar Dairevi yol, AZ 1070</div>
        </div>
    </div>

    <!-- Block Details -->
    <div class="block-details mt-4" id="blockDetails" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h3 id="selectedBlockName">Детали блока</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Основная информация</h5>
                        <ul class="list-unstyled">
                            <li><strong>Этажей:</strong> <span id="blockFloors">-</span></li>
                            <li><strong>Квартир:</strong> <span id="blockApartments">-</span></li>
                            <li><strong>Жителей:</strong> <span id="blockResidents">-</span></li>
                            <li><strong>Заселенность:</strong> <span id="blockOccupancy">-</span></li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5>Быстрые действия</h5>
                        <div class="d-flex flex-column gap-2">
                            <button class="btn btn-success btn-sm" onclick="viewApartments()">
                                <i class="bi bi-list"></i> Список квартир
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="viewResidents()">
                                <i class="bi bi-people"></i> Список жителей
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="viewMeters()">
                                <i class="bi bi-speedometer"></i> Показатели счетчиков
                            </button>
                            <hr>
                            <button class="btn btn-warning btn-sm" onclick="renameBlock()">
                                <i class="bi bi-pencil"></i> Переименовать
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteBlock()">
                                <i class="bi bi-trash"></i> Удалить блок
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let selectedBlock = null;
    
    function selectBlock(blockName) {
        selectedBlock = blockName;
        
        // Remove active class from all blocks
        document.querySelectorAll('.block-card').forEach(card => {
            card.classList.remove('active');
        });
        
        // Add active class to selected block
        document.querySelector(`[data-block="${blockName}"]`).classList.add('active');
        
        // Show block details
        document.getElementById('blockDetails').style.display = 'block';
        document.getElementById('selectedBlockName').textContent = `Блок ${blockName}`;
        
        // Sample data - replace with actual data
        const blockData = {
            'A': {floors: 10, apartments: 80, residents: 320, occupancy: '100%'},
            'B': {floors: 10, apartments: 80, residents: 315, occupancy: '98%'},
            'K': {floors: 12, apartments: 96, residents: 385, occupancy: '100%'},
            'X': {floors: 15, apartments: 120, residents: 480, occupancy: '100%'},
            'Z': {floors: 8, apartments: 64, residents: 256, occupancy: '100%'}
        };
        
        const data = blockData[blockName];
        if (data) {
            document.getElementById('blockFloors').textContent = data.floors;
            document.getElementById('blockApartments').textContent = data.apartments;
            document.getElementById('blockResidents').textContent = data.residents;
            document.getElementById('blockOccupancy').textContent = data.occupancy;
        }
        
        // Smooth scroll to details
        setTimeout(() => {
            document.getElementById('blockDetails').scrollIntoView({behavior: 'smooth'});
        }, 100);
    }
    
    function createBlock() {
        const blockName = document.getElementById('newBlockName').value.trim();
        
        if (!blockName) {
            showWarning('Пожалуйста, введите название блока');
            return;
        }
        
        // Create new block card
        const complexMap = document.getElementById('complexMap');
        const newBlockCard = document.createElement('div');
        newBlockCard.className = 'block-card';
        newBlockCard.setAttribute('data-block', blockName);
        newBlockCard.setAttribute('onclick', `selectBlock('${blockName}')`);
        newBlockCard.innerHTML = `
            <div class="block-name">Блок ${blockName}</div>
            <div class="block-info">
                <div>0 этажей</div>
                <div>0 квартир</div>
                <div>0 жителей</div>
            </div>
        `;
        
        complexMap.appendChild(newBlockCard);
        
        // Clear input
        document.getElementById('newBlockName').value = '';
        
        // Show success message
        showSuccess(`Блок ${blockName} успешно создан!`);
        
        // TODO: Send to backend API
        // fetch('/api/blocks', {
        //     method: 'POST',
        //     headers: {'Content-Type': 'application/json'},
        //     body: JSON.stringify({name: blockName})
        // });
    }
    
    function renameBlock() {
        if (!selectedBlock) {
            showWarning('Пожалуйста, выберите блок');
            return;
        }
        
        showPrompt(`Введите новое название для блока ${selectedBlock}:`, selectedBlock, (newName) => {
            if (newName && newName.trim() !== '' && newName !== selectedBlock) {
                const blockCard = document.querySelector(`[data-block="${selectedBlock}"]`);
                if (blockCard) {
                    // Update block card
                    blockCard.setAttribute('data-block', newName);
                    blockCard.setAttribute('onclick', `selectBlock('${newName}')`);
                    blockCard.querySelector('.block-name').textContent = `Блок ${newName}`;
                    
                    // Update selected block name
                    document.getElementById('selectedBlockName').textContent = `Блок ${newName}`;
                    selectedBlock = newName;
                    
                    showSuccess(`Блок успешно переименован в ${newName}!`);
                    
                    // TODO: Send to backend API
                    // fetch(`/api/blocks/${selectedBlock}`, {
                    //     method: 'PUT',
                    //     headers: {'Content-Type': 'application/json'},
                    //     body: JSON.stringify({name: newName})
                    // });
                }
            }
        });
    }
    
    function deleteBlock() {
        if (!selectedBlock) {
            showWarning('Пожалуйста, выберите блок');
            return;
        }
        
        showConfirm(`Вы уверены, что хотите удалить блок ${selectedBlock}?`, () => {
            const blockCard = document.querySelector(`[data-block="${selectedBlock}"]`);
            if (blockCard) {
                // Remove block card with animation
                blockCard.style.transition = 'all 0.3s ease';
                blockCard.style.opacity = '0';
                blockCard.style.transform = 'scale(0.8)';
                
                setTimeout(() => {
                    blockCard.remove();
                    
                    // Hide block details
                    document.getElementById('blockDetails').style.display = 'none';
                    selectedBlock = null;
                    
                    showSuccess('Блок успешно удален!');
                }, 300);
                
                // TODO: Send to backend API
                // fetch(`/api/blocks/${selectedBlock}`, {
                //     method: 'DELETE'
                // });
            }
        });
    }
    
    function viewApartments() {
        if (!selectedBlock) {
            showWarning('Пожалуйста, выберите блок');
            return;
        }
        showInfo(`Переход к списку квартир блока ${selectedBlock}...`);
        // TODO: Navigate to apartments page with block filter
        // window.location.href = `/admin/apartments.html?block=${selectedBlock}`;
    }
    
    function viewResidents() {
        if (!selectedBlock) {
            showWarning('Пожалуйста, выберите блок');
            return;
        }
        showInfo(`Переход к списку жителей блока ${selectedBlock}...`);
        // TODO: Navigate to residents page with block filter
        // window.location.href = `/admin/residents.html?block=${selectedBlock}`;
    }
    
    function viewMeters() {
        if (!selectedBlock) {
            showWarning('Пожалуйста, выберите блок');
            return;
        }
        showInfo(`Переход к показателям счетчиков блока ${selectedBlock}...`);
        // TODO: Navigate to meters page with block filter
        // window.location.href = `/admin/meters.html?block=${selectedBlock}`;
    }
    
</script>


