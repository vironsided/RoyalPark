<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoyalPark - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Material Design Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.3.67/css/materialdesignicons.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/admin.css">
    
    <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø SIDEBAR - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –ü–†–ò–û–†–ò–¢–ï–¢ -->
    <style>
        /* –£–±–∏—Ä–∞–µ–º –±–µ–ª—É—é –ø–æ–ª–æ—Å—É —Å–≤–µ—Ä—Ö—É */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            overflow-x: hidden !important;
            background-color: #1a1d2e !important;
        }
        
        body {
            min-height: 100vh !important;
        }
        
        .admin-container {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .sidebar {
            width: 280px !important;
            transition: width 0.3s ease !important;
        }
        
        .sidebar.collapsed {
            width: 80px !important;
            min-width: 80px !important;
            max-width: 80px !important;
        }
        
        .sidebar.collapsed .logo-text,
        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .nav-badge,
        .sidebar.collapsed .nav-section-title {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .sidebar.collapsed .nav-item {
            justify-content: center !important;
        }
        
        .main-content {
            margin-left: 280px !important;
            width: calc(100vw - 280px) !important;
            transition: all 0.3s ease !important;
        }
        
        .sidebar.collapsed ~ .main-content {
            margin-left: 80px !important;
            width: calc(100vw - 80px) !important;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="logo-text">
                        <h2>RoyalPark</h2>
                        <p>Admin Panel</p>
                    </div>
                </div>
                <button class="toggle-sidebar" id="toggleSidebar">
                    <svg width="20" height="20" fill="currentColor">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">–ì–ª–∞–≤–Ω–æ–µ</div>
                    <a href="/dashboard" class="nav-item" data-route="/dashboard">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-dashboard"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </a>
                    <a href="/analytics" class="nav-item" data-route="/analytics">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-analytics"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                    </a>
                    <a href="/reports" class="nav-item" data-route="/reports">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–û—Ç—á–µ—Ç—ã</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                    <a href="/blocks" class="nav-item" data-route="/blocks">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-buildings"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_blocks">–ë–ª–æ–∫–∏</span>
                    </a>
                    <a href="/tariffs" class="nav-item" data-route="/tariffs">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-payments"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_tariffs">–¢–∞—Ä–∏—Ñ—ã</span>
                    </a>
                    <a href="/residents" class="nav-item" data-route="/residents">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-users"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_residents">–†–µ–∑–∏–¥–µ–Ω—Ç—ã</span>
                        <span class="nav-badge">245</span>
                    </a>
                    <a href="/tenants" class="nav-item" data-route="/tenants">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-apartments"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_tenants">–ñ–∏—Ç–µ–ª–∏</span>
                    </a>
                    <a href="/readings" class="nav-item" data-route="/readings">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-meters"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_readings">–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏</span>
                    </a>
                    <a href="/users" class="nav-item" data-route="/users">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-users"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–§–∏–Ω–∞–Ω—Å—ã</div>
                    <a href="/payments" class="nav-item" data-route="/payments">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-payments"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–ª–∞—Ç–µ–∂–∏</span>
                    </a>
                    <a href="/invoices" class="nav-item" data-route="/invoices">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-bills"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–°—á–µ—Ç–∞</span>
                        <span class="nav-badge">12</span>
                    </a>
                    <a href="/debts" class="nav-item" data-route="/debts">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-debts"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</div>
                    <a href="/repair-requests" class="nav-item" data-route="/repair-requests">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-maintenance"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–º–æ–Ω—Ç</span>
                        <span class="nav-badge">8</span>
                    </a>
                    <a href="/inspections" class="nav-item" data-route="/inspections">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-inspections"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü—Ä–æ–≤–µ—Ä–∫–∏</span>
                    </a>
                    <a href="/staff" class="nav-item" data-route="/staff">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-personnel"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–µ—Ä—Å–æ–Ω–∞–ª</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–°–∏—Å—Ç–µ–º–∞</div>
                    <a href="/settings" class="nav-item" data-route="/settings">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-settings"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </a>
                    <a href="/logs" class="nav-item" data-route="/logs">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–õ–æ–≥–∏</span>
                    </a>
                    <a href="/backup" class="nav-item" data-route="/backup">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </a>
                    <a href="/login.html" class="nav-item logout-btn" id="logoutBtn">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-logout"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–í—ã—Ö–æ–¥</span>
                    </a>
                </div>
            </nav>
        </aside>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="page-title" id="page-title-container">
                    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                    <div class="page-breadcrumb">
                        <span class="breadcrumb-item">
                            <svg width="14" height="14" fill="currentColor" style="margin-right: 0.25rem; vertical-align: middle;">
                                <use href="/images/icons.svg#icon-apartments"></use>
                            </svg>
                            –ì–ª–∞–≤–Ω–∞—è
                        </span>
                        <span>‚Ä∫</span>
                        <span class="breadcrumb-item">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </div>
                </div>

                <div class="top-bar-actions">
                    <div class="search-box">
                        <span class="search-icon">
                            <svg width="16" height="16" fill="currentColor">
                                <use href="/images/icons.svg#icon-inspections"></use>
                            </svg>
                        </span>
                        <input type="text" placeholder="–ü–æ–∏—Å–∫...">
                    </div>

                    <button class="notification-btn">
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                        </svg>
                        <span class="notification-badge">3</span>
                    </button>

                    <!-- Theme Toggle -->
                    <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        <svg width="20" height="20" fill="currentColor" class="theme-icon-light">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                        <svg width="20" height="20" fill="currentColor" class="theme-icon-dark" style="display: none;">
                            <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                    </button>

                    <!-- Language Selector -->
                    <div class="language-selector">
                        <button class="lang-btn active" data-lang="ru" title="–†—É—Å—Å–∫–∏–π">RU</button>
                        <button class="lang-btn" data-lang="az" title="Az…ôrbaycan">AZ</button>
                        <button class="lang-btn" data-lang="en" title="English">EN</button>
                    </div>

                    <div class="user-profile" id="accountProfileBtn">
                        <div class="user-avatar">–ê–î</div>
                        <div class="user-info">
                            <div class="user-name">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                            <div class="user-role">–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SPA Content Container -->
            <div id="spa-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </main>
    </div>

    <!-- Account Settings Modal -->
    <div class="account-modal-overlay" id="accountModal">
        <div class="account-modal">
            <div class="account-modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</h2>
                <button class="account-modal-close" id="accountModalClose">&times;</button>
            </div>
            <div class="account-modal-body">
                <div class="account-avatar-large" id="accountModalAvatar">–ê–î</div>
                
                <div class="account-info-section">
                    <h3>
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ
                    </h3>
                    <div class="account-info-item">
                        <span class="account-info-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                        <span class="account-info-value" id="accountUsername">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–†–æ–ª—å:</span>
                        <span class="account-info-value" id="accountRole">–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">Email:</span>
                        <span class="account-info-value" id="accountEmail">admin@royalpark.az</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                        <span class="account-info-value" id="accountPhone">+994 12 345 67 89</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                        <span class="account-info-value" id="accountRegDate">01.01.2024</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</span>
                        <span class="account-info-value" id="accountLastLogin">–°–µ–≥–æ–¥–Ω—è, 10:30</span>
                    </div>
                </div>

                <div class="account-info-section">
                    <h3>
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                        </svg>
                        –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
                    </h3>
                    <div class="account-form-group">
                        <label>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="currentPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="account-form-group">
                        <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="newPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="account-form-group">
                        <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="confirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                    </div>
                </div>

                <div class="account-info-section">
                    <h3>
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </h3>
                    <div class="account-form-group">
                        <label>–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
                        <select id="accountLanguage">
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                            <option value="az">Az…ôrbaycan</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="account-form-group">
                        <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                        <select id="accountTheme">
                            <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark">–¢—ë–º–Ω–∞—è</option>
                            <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="account-modal-footer">
                <button class="account-btn account-btn-secondary" id="accountModalCancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="account-btn account-btn-primary" id="accountModalSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Notifications System -->
    <script src="/js/notifications.js"></script>
    
    <!-- Test Data (mock data for SPA pages) -->
    <script src="/js/test-data.js"></script>
    
    <!-- Sidebar Toggle (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏) -->
    <script src="/js/sidebar-toggle.js"></script>
    
    <!-- Theme Management -->
    <script src="/js/theme.js"></script>
    
    <!-- Language Management -->
    <script src="/js/i18n.js"></script>
    <script src="/js/i18n-auto.js"></script>
    
    <!-- Custom JS -->
    <script src="/js/admin.js"></script>
    
    <!-- SPA Router -->
    <script src="/js/spa-router.js"></script>
    
    <!-- Initialize Theme Toggle and Language Selector -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme Toggle Button
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    // Change theme
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    
                    // Update icons
                    const lightIcon = this.querySelector('.theme-icon-light');
                    const darkIcon = this.querySelector('.theme-icon-dark');
                    
                    if (newTheme === 'dark') {
                        lightIcon.style.display = 'none';
                        darkIcon.style.display = 'block';
                    } else {
                        lightIcon.style.display = 'block';
                        darkIcon.style.display = 'none';
                    }
                    
                    // Show notification
                    if (window.showSuccess) {
                        showSuccess(newTheme === 'dark' ? 'üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                    }
                });
                
                // Initialize theme on load
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                const lightIcon = themeToggle.querySelector('.theme-icon-light');
                const darkIcon = themeToggle.querySelector('.theme-icon-dark');
                
                if (savedTheme === 'dark') {
                    lightIcon.style.display = 'none';
                    darkIcon.style.display = 'block';
                } else {
                    lightIcon.style.display = 'block';
                    darkIcon.style.display = 'none';
                }
            }
            
            // Language Selector Buttons
            const langButtons = document.querySelectorAll('.lang-btn');
            langButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    
                    // Remove active from all buttons
                    langButtons.forEach(b => b.classList.remove('active'));
                    
                    // Add active to clicked button
                    this.classList.add('active');
                    
                    // Apply language if i18n is available
                    if (window.i18n) {
                        window.i18n.applyLanguage(lang);
                        localStorage.setItem('language', lang);
                        
                        // Show notification
                        if (window.showSuccess) {
                            const langNames = { ru: 'üá∑üá∫ –†—É—Å—Å–∫–∏–π', az: 'üá¶üáø Az…ôrbaycan', en: 'üá¨üáß English' };
                            showSuccess(`${langNames[lang] || lang} —è–∑—ã–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω`);
                        }
                    }
                });
            });
            
            // Initialize language on load
            const savedLang = localStorage.getItem('language') || 'ru';
            const activeLangBtn = document.querySelector(`.lang-btn[data-lang="${savedLang}"]`);
            if (activeLangBtn) {
                langButtons.forEach(b => b.classList.remove('active'));
                activeLangBtn.classList.add('active');
            }
            
            // Apply saved language
            if (window.i18n) {
                window.i18n.applyLanguage(savedLang);
            }
            
            // Sidebar Toggle Button - FIXED VERSION
            const toggleSidebarBtn = document.getElementById('toggleSidebar');
            const sidebar = document.querySelector('.sidebar');
            
            console.log('=== SIDEBAR DEBUG ===');
            console.log('Toggle button found:', !!toggleSidebarBtn);
            console.log('Sidebar found:', !!sidebar);
            
            if (toggleSidebarBtn && sidebar) {
                // Add tooltips to nav items
                const navItems = sidebar.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    const textEl = item.querySelector('.nav-text');
                    if (textEl && textEl.textContent.trim()) {
                        item.setAttribute('data-tooltip', textEl.textContent.trim());
                    }
                });
                
                // Load saved state
                const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                console.log('Saved collapsed state:', sidebarCollapsed);
                
                if (sidebarCollapsed) {
                    sidebar.classList.add('collapsed');
                    console.log('Applied collapsed class from saved state');
                }
                
                // Elements for mobile overlay
                const sidebarOverlay = document.getElementById('sidebarOverlay');

                // Toggle on click - desktop and mobile
                toggleSidebarBtn.onclick = function(e) {
                    console.log('=== CLICK EVENT FIRED ===');
                    e.preventDefault();
                    e.stopPropagation();

                    const isMobile = window.innerWidth <= 768;
                    if (isMobile) {
                        const willOpen = !sidebar.classList.contains('open');
                        sidebar.classList.toggle('open', willOpen);
                        if (sidebarOverlay) sidebarOverlay.classList.toggle('show', willOpen);
                        return;
                    }

                    const isCurrentlyCollapsed = sidebar.classList.contains('collapsed');
                    if (isCurrentlyCollapsed) {
                        sidebar.classList.remove('collapsed');
                        localStorage.setItem('sidebarCollapsed', 'false');
                    } else {
                        sidebar.classList.add('collapsed');
                        localStorage.setItem('sidebarCollapsed', 'true');
                    }
                };

                // Close on overlay click (mobile)
                if (sidebarOverlay) {
                    sidebarOverlay.addEventListener('click', function() {
                        sidebar.classList.remove('open');
                        sidebarOverlay.classList.remove('show');
                    });
                }

                // ESC to close (mobile)
                document.addEventListener('keydown', function(ev) {
                    if ((ev.key === 'Escape' || ev.keyCode === 27) && window.innerWidth <= 768) {
                        if (sidebar.classList.contains('open')) {
                            sidebar.classList.remove('open');
                            if (sidebarOverlay) sidebarOverlay.classList.remove('show');
                        }
                    }
                });

                // Handle resize - cleanup mobile classes when returning to desktop
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        sidebar.classList.remove('open');
                        if (sidebarOverlay) sidebarOverlay.classList.remove('show');
                    }
                });
                
                // Debug: log current state
                console.log('Sidebar initialized successfully');
                console.log('Initial collapsed state:', sidebar.classList.contains('collapsed'));
                console.log('Initial width:', sidebar.offsetWidth);
                
                // Add global function for debugging
                window.debugSidebar = function() {
                    console.log('=== SIDEBAR DEBUG INFO ===');
                    console.log('Has collapsed class:', sidebar.classList.contains('collapsed'));
                    console.log('Current width:', sidebar.offsetWidth);
                    console.log('Computed width:', window.getComputedStyle(sidebar).width);
                    console.log('localStorage value:', localStorage.getItem('sidebarCollapsed'));
                    console.log('All classes:', Array.from(sidebar.classList));
                };
                
                window.resetSidebar = function() {
                    localStorage.removeItem('sidebarCollapsed');
                    sidebar.classList.remove('collapsed');
                    console.log('‚úÖ Sidebar reset! Reload the page.');
                };
                
                console.log('üí° Type debugSidebar() to see current state');
                console.log('üí° Type resetSidebar() to reset and reload');
            } else {
                console.error('‚ùå ERROR: Sidebar or toggle button not found!');
                if (!toggleSidebarBtn) console.error('Toggle button element is missing!');
                if (!sidebar) console.error('Sidebar element is missing!');
            }
            
            // Logout Button Handler
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Clear all session data
                    localStorage.clear();
                    sessionStorage.clear();
                    
                    // Show notification
                    if (window.showInfo) {
                        showInfo('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
                    }
                    
                    // Redirect to login page after a short delay
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 500);
                });
            }
            
            // Account Settings Modal
            const accountProfileBtn = document.getElementById('accountProfileBtn');
            const accountModal = document.getElementById('accountModal');
            const accountModalClose = document.getElementById('accountModalClose');
            const accountModalCancel = document.getElementById('accountModalCancel');
            const accountModalSave = document.getElementById('accountModalSave');
            
            function openAccountModal() {
                if (accountModal) {
                    accountModal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                    
                    // Load current settings
                    const savedLang = localStorage.getItem('language') || 'ru';
                    const savedTheme = localStorage.getItem('theme') || 'light';
                    const langSelect = document.getElementById('accountLanguage');
                    const themeSelect = document.getElementById('accountTheme');
                    
                    if (langSelect) langSelect.value = savedLang;
                    if (themeSelect) themeSelect.value = savedTheme;
                }
            }
            
            function closeAccountModal() {
                if (accountModal) {
                    accountModal.classList.remove('show');
                    document.body.style.overflow = '';
                }
            }
            
            if (accountProfileBtn) {
                accountProfileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    openAccountModal();
                });
            }
            
            if (accountModalClose) {
                accountModalClose.addEventListener('click', closeAccountModal);
            }
            
            if (accountModalCancel) {
                accountModalCancel.addEventListener('click', closeAccountModal);
            }
            
            if (accountModal) {
                accountModal.addEventListener('click', function(e) {
                    if (e.target === accountModal) {
                        closeAccountModal();
                    }
                });
            }
            
            if (accountModalSave) {
                accountModalSave.addEventListener('click', function() {
                    const currentPassword = document.getElementById('currentPassword')?.value;
                    const newPassword = document.getElementById('newPassword')?.value;
                    const confirmPassword = document.getElementById('confirmPassword')?.value;
                    const langSelect = document.getElementById('accountLanguage');
                    const themeSelect = document.getElementById('accountTheme');
                    
                    // Save language and theme
                    if (langSelect) {
                        const lang = langSelect.value;
                        localStorage.setItem('language', lang);
                        if (window.i18n) {
                            window.i18n.applyLanguage(lang);
                        }
                    }
                    
                    if (themeSelect) {
                        const theme = themeSelect.value;
                        if (theme !== 'auto') {
                            localStorage.setItem('theme', theme);
                            document.documentElement.setAttribute('data-theme', theme);
                            
                            // Update theme toggle icon
                            const themeToggle = document.getElementById('themeToggle');
                            if (themeToggle) {
                                const lightIcon = themeToggle.querySelector('.theme-icon-light');
                                const darkIcon = themeToggle.querySelector('.theme-icon-dark');
                                if (theme === 'dark') {
                                    if (lightIcon) lightIcon.style.display = 'none';
                                    if (darkIcon) darkIcon.style.display = 'block';
                                } else {
                                    if (lightIcon) lightIcon.style.display = 'block';
                                    if (darkIcon) darkIcon.style.display = 'none';
                                }
                            }
                        }
                    }
                    
                    // Handle password change
                    if (newPassword && confirmPassword) {
                        if (newPassword !== confirmPassword) {
                            if (window.showError) {
                                showError('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                            }
                            return;
                        }
                        if (newPassword.length < 6) {
                            if (window.showError) {
                                showError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤!');
                            }
                            return;
                        }
                        // Here you would send password change request to server
                        if (window.showSuccess) {
                            showSuccess('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω!');
                        }
                    }
                    
                    if (window.showSuccess) {
                        showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                    }
                    
                    // Clear password fields
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    
                    closeAccountModal();
                });
            }
            
            // Close modal on ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && accountModal && accountModal.classList.contains('show')) {
                    closeAccountModal();
                }
            });
        });
    </script>
</body>
</html>




