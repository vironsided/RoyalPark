<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoyalPark - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Material Design Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.3.67/css/materialdesignicons.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/admin.css">
    
    <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø SIDEBAR - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –ü–†–ò–û–†–ò–¢–ï–¢ -->
    <style>
        /* –£–±–∏—Ä–∞–µ–º –±–µ–ª—É—é –ø–æ–ª–æ—Å—É —Å–≤–µ—Ä—Ö—É */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            overflow-x: hidden !important;
            background-color: #1a1d2e !important;
        }
        
        body {
            min-height: 100vh !important;
        }
        
        .admin-container {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .sidebar {
            width: 280px !important;
            transition: width 0.3s ease !important;
        }
        
        .sidebar.collapsed {
            width: 80px !important;
            min-width: 80px !important;
            max-width: 80px !important;
        }
        
        .sidebar.collapsed .logo-text,
        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .nav-badge,
        .sidebar.collapsed .nav-section-title {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .sidebar.collapsed .nav-item {
            justify-content: center !important;
        }
        
        .main-content {
            margin-left: 280px !important;
            width: calc(100vw - 280px) !important;
            transition: all 0.3s ease !important;
        }
        
        .sidebar.collapsed ~ .main-content {
            margin-left: 80px !important;
            width: calc(100vw - 80px) !important;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="logo-text">
                        <h2>RoyalPark</h2>
                        <p>Admin Panel</p>
                    </div>
                </div>
                <button class="toggle-sidebar" id="toggleSidebar">
                    <svg width="20" height="20" fill="currentColor">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">–ì–ª–∞–≤–Ω–æ–µ</div>
                    <a href="/dashboard" class="nav-item" data-route="/dashboard">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-dashboard"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </a>
                    <a href="/analytics" class="nav-item" data-route="/analytics">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-analytics"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                    </a>
                    <a href="/reports" class="nav-item" data-route="/reports">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–û—Ç—á–µ—Ç—ã</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                    <a href="/blocks" class="nav-item" data-route="/blocks">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-buildings"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_blocks">–ë–ª–æ–∫–∏</span>
                    </a>
                    <a href="/tariffs" class="nav-item" data-route="/tariffs">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-payments"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_tariffs">–¢–∞—Ä–∏—Ñ—ã</span>
                    </a>
                    <a href="/residents" class="nav-item" data-route="/residents">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-users"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_residents">–†–µ–∑–∏–¥–µ–Ω—Ç—ã</span>
                        <span class="nav-badge">245</span>
                    </a>
                    <a href="/tenants" class="nav-item" data-route="/tenants">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-apartments"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_tenants">–ñ–∏—Ç–µ–ª–∏</span>
                    </a>
                    <a href="/readings" class="nav-item" data-route="/readings">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-meters"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_readings">–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏</span>
                    </a>
                    <a href="/users" class="nav-item" data-route="/users">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-users"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–§–∏–Ω–∞–Ω—Å—ã</div>
                    <a href="/payments" class="nav-item" data-route="/payments">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-payments"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–ª–∞—Ç–µ–∂–∏</span>
                    </a>
                    <a href="/invoices" class="nav-item" data-route="/invoices">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-bills"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–°—á–µ—Ç–∞</span>
                        <span class="nav-badge">12</span>
                    </a>
                    <a href="/debts" class="nav-item" data-route="/debts">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-debts"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</div>
                    <a href="/repair-requests" class="nav-item" data-route="/repair-requests">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-maintenance"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–º–æ–Ω—Ç</span>
                        <span class="nav-badge">8</span>
                    </a>
                    <a href="/inspections" class="nav-item" data-route="/inspections">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-inspections"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü—Ä–æ–≤–µ—Ä–∫–∏</span>
                    </a>
                    <a href="/staff" class="nav-item" data-route="/staff">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-personnel"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–µ—Ä—Å–æ–Ω–∞–ª</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–°–∏—Å—Ç–µ–º–∞</div>
                    <a href="/settings" class="nav-item" data-route="/settings">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-settings"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </a>
                    <a href="/logs" class="nav-item" data-route="/logs">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–õ–æ–≥–∏</span>
                    </a>
                    <a href="/backup" class="nav-item" data-route="/backup">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="page-title" id="page-title-container">
                    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                    <div class="page-breadcrumb">
                        <span class="breadcrumb-item">
                            <svg width="14" height="14" fill="currentColor" style="margin-right: 0.25rem; vertical-align: middle;">
                                <use href="/images/icons.svg#icon-apartments"></use>
                            </svg>
                            –ì–ª–∞–≤–Ω–∞—è
                        </span>
                        <span>‚Ä∫</span>
                        <span class="breadcrumb-item">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </div>
                </div>

                <div class="top-bar-actions">
                    <div class="search-box">
                        <span class="search-icon">
                            <svg width="16" height="16" fill="currentColor">
                                <use href="/images/icons.svg#icon-inspections"></use>
                            </svg>
                        </span>
                        <input type="text" placeholder="–ü–æ–∏—Å–∫...">
                    </div>

                    <button class="notification-btn">
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                        </svg>
                        <span class="notification-badge">3</span>
                    </button>

                    <!-- Theme Toggle -->
                    <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        <svg width="20" height="20" fill="currentColor" class="theme-icon-light">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                        <svg width="20" height="20" fill="currentColor" class="theme-icon-dark" style="display: none;">
                            <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                    </button>

                    <!-- Language Selector -->
                    <div class="language-selector">
                        <button class="lang-btn active" data-lang="ru" title="–†—É—Å—Å–∫–∏–π">RU</button>
                        <button class="lang-btn" data-lang="az" title="Az…ôrbaycan">AZ</button>
                        <button class="lang-btn" data-lang="en" title="English">EN</button>
                    </div>

                    <div class="user-profile">
                        <div class="user-avatar">–ê–î</div>
                        <div class="user-info">
                            <div class="user-name">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                            <div class="user-role">–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SPA Content Container -->
            <div id="spa-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </main>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Notifications System -->
    <script src="/js/notifications.js"></script>
    
    <!-- Sidebar Toggle (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏) -->
    <script src="/js/sidebar-toggle.js"></script>
    
    <!-- Theme Management -->
    <script src="/js/theme.js"></script>
    
    <!-- Language Management -->
    <script src="/js/i18n.js"></script>
    <script src="/js/i18n-auto.js"></script>
    
    <!-- Custom JS -->
    <script src="/js/admin.js"></script>
    
    <!-- SPA Router -->
    <script src="/js/spa-router.js"></script>
    
    <!-- Initialize Theme Toggle and Language Selector -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme Toggle Button
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    // Change theme
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    
                    // Update icons
                    const lightIcon = this.querySelector('.theme-icon-light');
                    const darkIcon = this.querySelector('.theme-icon-dark');
                    
                    if (newTheme === 'dark') {
                        lightIcon.style.display = 'none';
                        darkIcon.style.display = 'block';
                    } else {
                        lightIcon.style.display = 'block';
                        darkIcon.style.display = 'none';
                    }
                    
                    // Show notification
                    if (window.showSuccess) {
                        showSuccess(newTheme === 'dark' ? 'üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                    }
                });
                
                // Initialize theme on load
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                const lightIcon = themeToggle.querySelector('.theme-icon-light');
                const darkIcon = themeToggle.querySelector('.theme-icon-dark');
                
                if (savedTheme === 'dark') {
                    lightIcon.style.display = 'none';
                    darkIcon.style.display = 'block';
                } else {
                    lightIcon.style.display = 'block';
                    darkIcon.style.display = 'none';
                }
            }
            
            // Language Selector Buttons
            const langButtons = document.querySelectorAll('.lang-btn');
            langButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    
                    // Remove active from all buttons
                    langButtons.forEach(b => b.classList.remove('active'));
                    
                    // Add active to clicked button
                    this.classList.add('active');
                    
                    // Apply language if i18n is available
                    if (window.i18n) {
                        window.i18n.applyLanguage(lang);
                        localStorage.setItem('language', lang);
                        
                        // Show notification
                        if (window.showSuccess) {
                            const langNames = { ru: 'üá∑üá∫ –†—É—Å—Å–∫–∏–π', az: 'üá¶üáø Az…ôrbaycan', en: 'üá¨üáß English' };
                            showSuccess(`${langNames[lang] || lang} —è–∑—ã–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω`);
                        }
                    }
                });
            });
            
            // Initialize language on load
            const savedLang = localStorage.getItem('language') || 'ru';
            const activeLangBtn = document.querySelector(`.lang-btn[data-lang="${savedLang}"]`);
            if (activeLangBtn) {
                langButtons.forEach(b => b.classList.remove('active'));
                activeLangBtn.classList.add('active');
            }
            
            // Apply saved language
            if (window.i18n) {
                window.i18n.applyLanguage(savedLang);
            }
            
            // Sidebar Toggle Button - FIXED VERSION
            const toggleSidebarBtn = document.getElementById('toggleSidebar');
            const sidebar = document.querySelector('.sidebar');
            
            console.log('=== SIDEBAR DEBUG ===');
            console.log('Toggle button found:', !!toggleSidebarBtn);
            console.log('Sidebar found:', !!sidebar);
            
            if (toggleSidebarBtn && sidebar) {
                // Add tooltips to nav items
                const navItems = sidebar.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    const textEl = item.querySelector('.nav-text');
                    if (textEl && textEl.textContent.trim()) {
                        item.setAttribute('data-tooltip', textEl.textContent.trim());
                    }
                });
                
                // Load saved state
                const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                console.log('Saved collapsed state:', sidebarCollapsed);
                
                if (sidebarCollapsed) {
                    sidebar.classList.add('collapsed');
                    console.log('Applied collapsed class from saved state');
                }
                
                // Toggle on click - MULTIPLE EVENT LISTENERS
                toggleSidebarBtn.onclick = function(e) {
                    console.log('=== CLICK EVENT FIRED ===');
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const currentClasses = Array.from(sidebar.classList);
                    console.log('Current sidebar classes:', currentClasses);
                    
                    const isCurrentlyCollapsed = sidebar.classList.contains('collapsed');
                    console.log('Is currently collapsed:', isCurrentlyCollapsed);
                    
                    if (isCurrentlyCollapsed) {
                        console.log('Attempting to EXPAND sidebar...');
                        sidebar.classList.remove('collapsed');
                        localStorage.setItem('sidebarCollapsed', 'false');
                        console.log('‚úÖ Sidebar EXPANDED. New classes:', Array.from(sidebar.classList));
                        if (window.showSuccess) {
                            showSuccess('üìå –ü–∞–Ω–µ–ª—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞');
                        }
                    } else {
                        console.log('Attempting to COLLAPSE sidebar...');
                        sidebar.classList.add('collapsed');
                        localStorage.setItem('sidebarCollapsed', 'true');
                        console.log('‚úÖ Sidebar COLLAPSED. New classes:', Array.from(sidebar.classList));
                        if (window.showInfo) {
                            showInfo('üìå –ü–∞–Ω–µ–ª—å —Å–≤—ë—Ä–Ω—É—Ç–∞');
                        }
                    }
                    
                    // Double check
                    setTimeout(() => {
                        console.log('After 100ms - Sidebar width:', sidebar.offsetWidth);
                        console.log('After 100ms - Has collapsed class:', sidebar.classList.contains('collapsed'));
                    }, 100);
                };
                
                // Debug: log current state
                console.log('Sidebar initialized successfully');
                console.log('Initial collapsed state:', sidebar.classList.contains('collapsed'));
                console.log('Initial width:', sidebar.offsetWidth);
                
                // Add global function for debugging
                window.debugSidebar = function() {
                    console.log('=== SIDEBAR DEBUG INFO ===');
                    console.log('Has collapsed class:', sidebar.classList.contains('collapsed'));
                    console.log('Current width:', sidebar.offsetWidth);
                    console.log('Computed width:', window.getComputedStyle(sidebar).width);
                    console.log('localStorage value:', localStorage.getItem('sidebarCollapsed'));
                    console.log('All classes:', Array.from(sidebar.classList));
                };
                
                window.resetSidebar = function() {
                    localStorage.removeItem('sidebarCollapsed');
                    sidebar.classList.remove('collapsed');
                    console.log('‚úÖ Sidebar reset! Reload the page.');
                };
                
                console.log('üí° Type debugSidebar() to see current state');
                console.log('üí° Type resetSidebar() to reset and reload');
            } else {
                console.error('‚ùå ERROR: Sidebar or toggle button not found!');
                if (!toggleSidebarBtn) console.error('Toggle button element is missing!');
                if (!sidebar) console.error('Sidebar element is missing!');
            }
        });
    </script>
</body>
</html>




