<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoyalPark - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Material Design Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.3.67/css/materialdesignicons.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/admin.css">
    
    <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø SIDEBAR - –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –ü–†–ò–û–†–ò–¢–ï–¢ -->
    <style>
        /* –£–±–∏—Ä–∞–µ–º –±–µ–ª—É—é –ø–æ–ª–æ—Å—É —Å–≤–µ—Ä—Ö—É */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            overflow-x: hidden !important;
            background-color: #1a1d2e !important;
        }
        
        body {
            min-height: 100vh !important;
        }
        
        .admin-container {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .sidebar {
            width: 280px !important;
            transition: width 0.3s ease !important;
        }
        
        .sidebar.collapsed {
            width: 80px !important;
            min-width: 80px !important;
            max-width: 80px !important;
        }
        
        .sidebar.collapsed .logo-text,
        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .nav-badge,
        .sidebar.collapsed .nav-section-title {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        .sidebar.collapsed .nav-item {
            justify-content: center !important;
        }
        
        .main-content {
            margin-left: 280px !important;
            width: calc(100vw - 280px) !important;
            transition: all 0.3s ease !important;
        }
        
        .sidebar.collapsed ~ .main-content {
            margin-left: 80px !important;
            width: calc(100vw - 80px) !important;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar collapsed" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="logo-text">
                        <h2>RoyalPark</h2>
                        <p>Admin Panel</p>
                    </div>
                </div>
                <button class="toggle-sidebar" id="toggleSidebar">
                    <svg width="20" height="20" fill="currentColor">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
            </div>

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">–ì–ª–∞–≤–Ω–æ–µ</div>
                    <a href="/dashboard" class="nav-item" data-route="/dashboard">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-dashboard"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </a>
                    <a href="/analytics" class="nav-item" data-route="/analytics">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-analytics"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                    </a>
                    <a href="/reports" class="nav-item" data-route="/reports">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–û—Ç—á–µ—Ç—ã</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                    <a href="/blocks" class="nav-item" data-route="/blocks">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-buildings"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_blocks">–ë–ª–æ–∫–∏</span>
                    </a>
                    <a href="/tariffs" class="nav-item" data-route="/tariffs">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-payments"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_tariffs">–¢–∞—Ä–∏—Ñ—ã</span>
                    </a>
                    <a href="/residents" class="nav-item" data-route="/residents">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-users"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_residents">–†–µ–∑–∏–¥–µ–Ω—Ç—ã</span>
                        <span class="nav-badge">245</span>
                    </a>
                    <a href="/tenants" class="nav-item" data-route="/tenants">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-apartments"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_tenants">–ñ–∏—Ç–µ–ª–∏</span>
                    </a>
                    <a href="/readings" class="nav-item" data-route="/readings">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-meters"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_readings">–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏</span>
                    </a>
                    <a href="/users" class="nav-item" data-route="/users">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-users"></use>
                            </svg>
                        </span>
                        <span class="nav-text" data-i18n="nav_users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–§–∏–Ω–∞–Ω—Å—ã</div>
                    <a href="/payments" class="nav-item" data-route="/payments">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-payments"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–ª–∞—Ç–µ–∂–∏</span>
                    </a>
                    <a href="/invoices" class="nav-item" data-route="/invoices">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-bills"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–°—á–µ—Ç–∞</span>
                        <span class="nav-badge">12</span>
                    </a>
                    <a href="/debts" class="nav-item" data-route="/debts">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-debts"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</div>
                    <a href="/repair-requests" class="nav-item" data-route="/repair-requests">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-maintenance"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–º–æ–Ω—Ç</span>
                        <span class="nav-badge">8</span>
                    </a>
                    <a href="/inspections" class="nav-item" data-route="/inspections">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-inspections"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü—Ä–æ–≤–µ—Ä–∫–∏</span>
                    </a>
                    <a href="/staff" class="nav-item" data-route="/staff">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-personnel"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ü–µ—Ä—Å–æ–Ω–∞–ª</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">–°–∏—Å—Ç–µ–º–∞</div>
                    <a href="/settings" class="nav-item" data-route="/settings">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-settings"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </a>
                    <a href="/logs" class="nav-item" data-route="/logs">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–õ–æ–≥–∏</span>
                    </a>
                    <a href="/backup" class="nav-item" data-route="/backup">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-reports"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </a>
                    <a href="/login.html" class="nav-item logout-btn" id="logoutBtn">
                        <span class="nav-icon">
                            <svg width="20" height="20" fill="currentColor">
                                <use href="/images/icons.svg#icon-logout"></use>
                            </svg>
                        </span>
                        <span class="nav-text">–í—ã—Ö–æ–¥</span>
                    </a>
                </div>
            </nav>
        </aside>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="page-title" id="page-title-container">
                    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                    <div class="page-breadcrumb">
                        <span class="breadcrumb-item">
                            <svg width="14" height="14" fill="currentColor" style="margin-right: 0.25rem; vertical-align: middle;">
                                <use href="/images/icons.svg#icon-apartments"></use>
                            </svg>
                            –ì–ª–∞–≤–Ω–∞—è
                        </span>
                        <span>‚Ä∫</span>
                        <span class="breadcrumb-item">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </div>
                </div>

                <div class="top-bar-actions">
                    <div class="search-box">
                        <span class="search-icon">
                            <svg width="16" height="16" fill="currentColor">
                                <use href="/images/icons.svg#icon-inspections"></use>
                            </svg>
                        </span>
                        <input type="text" placeholder="–ü–æ–∏—Å–∫..." id="topSearch" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" name="topSearch" />
                    </div>

                    <button class="notification-btn" id="openNotifications" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M12 22a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2zm6-6V11a6 6 0 1 0-12 0v5l-2 2v1h16v-1l-2-2z"/>
                        </svg>
                        <span class="notification-badge" id="notificationsCount">3</span>
                    </button>

                    <!-- Theme Toggle -->
                    <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        <!-- Moon (dark mode icon) -->
                        <svg class="theme-icon-dark" style="display: none;" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                        <!-- Sun (light mode icon) -->
                        <svg class="theme-icon-light" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="12" cy="12" r="4"></circle>
                            <line x1="12" y1="2" x2="12" y2="4"></line>
                            <line x1="12" y1="20" x2="12" y2="22"></line>
                            <line x1="2" y1="12" x2="4" y2="12"></line>
                            <line x1="20" y1="12" x2="22" y2="12"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>

                    <!-- Language Selector -->
                    <div class="language-selector">
                        <button class="lang-btn active" data-lang="ru" title="–†—É—Å—Å–∫–∏–π">RU</button>
                        <button class="lang-btn" data-lang="az" title="Az…ôrbaycan">AZ</button>
                        <button class="lang-btn" data-lang="en" title="English">EN</button>
                    </div>

                    <div class="user-profile" id="accountProfileBtn">
                        <div class="user-avatar">–ê–î</div>
                        <div class="user-info">
                            <div class="user-name">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                            <div class="user-role">–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SPA Content Container -->
            <div id="spa-content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </main>
    </div>

    <!-- Account Settings Modal -->
    <div class="account-modal-overlay" id="accountModal">
        <div class="account-modal">
            <div class="account-modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</h2>
                <button class="account-modal-close" id="accountModalClose">&times;</button>
            </div>
            <div class="account-modal-body">
                <div class="account-avatar-large" id="accountModalAvatar">–ê–î</div>
                
                <div class="account-info-section">
                    <h3>
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ
                    </h3>
                    <div class="account-info-item">
                        <span class="account-info-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                        <span class="account-info-value" id="accountUsername">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–†–æ–ª—å:</span>
                        <span class="account-info-value" id="accountRole">–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">Email:</span>
                        <span class="account-info-value" id="accountEmail">admin@royalpark.az</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                        <span class="account-info-value" id="accountPhone">+994 12 345 67 89</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                        <span class="account-info-value" id="accountRegDate">01.01.2024</span>
                    </div>
                    <div class="account-info-item">
                        <span class="account-info-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</span>
                        <span class="account-info-value" id="accountLastLogin">–°–µ–≥–æ–¥–Ω—è, 10:30</span>
                    </div>
                </div>

                <div class="account-info-section">
                    <h3>
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                        </svg>
                        –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
                    </h3>
                    <div class="account-form-group">
                        <label>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="currentPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="account-form-group">
                        <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="newPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="account-form-group">
                        <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="confirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                    </div>
                </div>

                <div class="account-info-section">
                    <h3>
                        <svg width="20" height="20" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </h3>
                    <div class="account-form-group">
                        <label>–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
                        <select id="accountLanguage">
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                            <option value="az">Az…ôrbaycan</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="account-form-group">
                        <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                        <select id="accountTheme">
                            <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark">–¢—ë–º–Ω–∞—è</option>
                            <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="account-modal-footer">
                <button class="account-btn account-btn-secondary" id="accountModalCancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="account-btn account-btn-primary" id="accountModalSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="account-modal-overlay" id="notificationsModal">
        <div class="account-modal" style="max-width:680px;">
            <div class="account-modal-header">
                <h2>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
                <button class="account-modal-close" id="notificationsClose">&times;</button>
            </div>
            <div class="account-modal-body">
                <div class="account-info-section" style="margin-bottom:1rem;">
                    <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                        <button class="account-btn account-btn-secondary" id="notifFilterAll">–í—Å–µ</button>
                        <button class="account-btn account-btn-secondary" id="notifFilterImportant">–í–∞–∂–Ω—ã–µ</button>
                        <button class="account-btn account-btn-secondary" id="notifFilterSystem">–°–∏—Å—Ç–µ–º–Ω—ã–µ</button>
                    </div>
                </div>
                <div id="notificationsList"></div>
            </div>
            <div class="account-modal-footer">
                <button class="account-btn account-btn-secondary" id="notificationsMarkRead">–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏</button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Notifications System -->
    <script src="/js/notifications.js"></script>
    
    <!-- Test Data (mock data for SPA pages) -->
    <script src="/js/test-data.js"></script>
    
    <!-- Sidebar Toggle (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏) -->
    <script src="/js/sidebar-toggle.js"></script>
    
    <!-- Theme Management -->
    <script src="/js/theme.js"></script>
    
    <!-- Language Management -->
    <script src="/js/i18n.js"></script>
    <script src="/js/i18n-auto.js"></script>
    
    <!-- Custom JS -->
    <script src="/js/admin.js"></script>
    
    <!-- SPA Router -->
    <script src="/js/spa-router.js"></script>
    
    <!-- Initialize Theme Toggle and Language Selector -->
    <script>
        // Global function to hide plan tooltip from blocks page
        function hidePlanTooltip() {
            const tooltip = document.getElementById('planTooltip');
            if (tooltip) {
                tooltip.classList.add('hidden');
                tooltip.style.display = 'none';
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            }
        }
        
        // Hide tooltip on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', hidePlanTooltip);
        } else {
            hidePlanTooltip();
        }
        
        // Hide tooltip on hash change (navigation)
        window.addEventListener('hashchange', hidePlanTooltip);
        
        // Hide tooltip on popstate (browser back/forward)
        window.addEventListener('popstate', hidePlanTooltip);
        
        // Make function globally accessible
        window.hidePlanTooltip = hidePlanTooltip;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Theme Toggle Button
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    // Change theme
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    
                    // Update icons
                    const lightIcon = this.querySelector('.theme-icon-light');
                    const darkIcon = this.querySelector('.theme-icon-dark');
                    
                    if (newTheme === 'dark') {
                        lightIcon.style.display = 'none';
                        darkIcon.style.display = 'block';
                    } else {
                        lightIcon.style.display = 'block';
                        darkIcon.style.display = 'none';
                    }
                    
                    // Show notification
                    if (window.showSuccess) {
                        showSuccess(newTheme === 'dark' ? 'üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                    }
                });
                
                // Initialize theme on load
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                const lightIcon = themeToggle.querySelector('.theme-icon-light');
                const darkIcon = themeToggle.querySelector('.theme-icon-dark');
                
                if (savedTheme === 'dark') {
                    lightIcon.style.display = 'none';
                    darkIcon.style.display = 'block';
                } else {
                    lightIcon.style.display = 'block';
                    darkIcon.style.display = 'none';
                }
            }
            
            // Clear top search on load to avoid browser autofill
            const topSearch = document.getElementById('topSearch');
            if (topSearch) {
                // Hard reset value and attributes to defeat browser autofill
                topSearch.value = '';
                topSearch.setAttribute('value', '');
                topSearch.setAttribute('autocomplete', 'off');
                topSearch.setAttribute('autocapitalize', 'off');
                topSearch.setAttribute('autocorrect', 'off');
                // Randomize name each load so the browser has no stored value
                topSearch.setAttribute('name', 'topSearch_' + Math.random().toString(36).slice(2));
                // Clear again shortly after load (some browsers fill asynchronously)
                setTimeout(() => { if (topSearch) { topSearch.value = ''; topSearch.setAttribute('value',''); } }, 250);
                // Clear on pageshow (bfcache restore)
                window.addEventListener('pageshow', () => { if (topSearch) { topSearch.value=''; topSearch.setAttribute('value',''); } });
                // Clear on route changes in SPA
                window.addEventListener('hashchange', () => { if (topSearch) { topSearch.value=''; topSearch.setAttribute('value',''); } });
                // If browser still injects text, wipe on focus
                topSearch.addEventListener('focus', () => {
                    if (topSearch.value && topSearch.value.toLowerCase() === 'admin') {
                        topSearch.value = '';
                        topSearch.setAttribute('value','');
                    }
                });
            }

            // Language Selector Buttons
            const langButtons = document.querySelectorAll('.lang-btn');
            langButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    
                    // Remove active from all buttons
                    langButtons.forEach(b => b.classList.remove('active'));
                    
                    // Add active to clicked button
                    this.classList.add('active');
                    
                    // Apply language if i18n is available
                    if (window.i18n) {
                        window.i18n.applyLanguage(lang);
                        localStorage.setItem('language', lang);
                        
                        // Show notification
                        if (window.showSuccess) {
                            const langNames = { ru: 'üá∑üá∫ –†—É—Å—Å–∫–∏–π', az: 'üá¶üáø Az…ôrbaycan', en: 'üá¨üáß English' };
                            showSuccess(`${langNames[lang] || lang} —è–∑—ã–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω`);
                        }
                    }
                });
            });
            
            // Initialize language on load
            const savedLang = localStorage.getItem('language') || 'ru';
            const activeLangBtn = document.querySelector(`.lang-btn[data-lang="${savedLang}"]`);
            if (activeLangBtn) {
                langButtons.forEach(b => b.classList.remove('active'));
                activeLangBtn.classList.add('active');
            }
            
            // Apply saved language
            if (window.i18n) {
                window.i18n.applyLanguage(savedLang);
            }
            
            // Sidebar Toggle Button - FIXED VERSION
            let toggleSidebarBtn = document.getElementById('toggleSidebar');
            const sidebar = document.getElementById('sidebar') || document.querySelector('.sidebar');
            
            console.log('=== SIDEBAR DEBUG ===');
            console.log('Toggle button found:', !!toggleSidebarBtn);
            console.log('Sidebar found:', !!sidebar);
            
            if (toggleSidebarBtn && sidebar) {
                // Remove any existing event listeners by cloning the button
                const newToggleBtn = toggleSidebarBtn.cloneNode(true);
                toggleSidebarBtn.parentNode.replaceChild(newToggleBtn, toggleSidebarBtn);
                toggleSidebarBtn = newToggleBtn;
                
                // Add tooltips to nav items
                const navItems = sidebar.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    const textEl = item.querySelector('.nav-text');
                    if (textEl && textEl.textContent.trim()) {
                        item.setAttribute('data-tooltip', textEl.textContent.trim());
                    }
                });
                
                // Load saved state
                let storedSidebarState = localStorage.getItem('sidebarCollapsed');
                if (storedSidebarState === null) {
                    // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–µ—Ä–∂–∏–º –º–µ–Ω—é –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º –≤–∏–¥–µ
                    storedSidebarState = 'true';
                    localStorage.setItem('sidebarCollapsed', 'true');
                }
                const sidebarCollapsed = storedSidebarState === 'true';
                console.log('Saved collapsed state:', sidebarCollapsed);
                
                if (sidebarCollapsed) {
                    sidebar.classList.add('collapsed');
                    console.log('Applied collapsed class from saved state');
                }
                
                // Elements for mobile overlay
                const sidebarOverlay = document.getElementById('sidebarOverlay');

                const handleToggleClick = function(e) {
                    console.log('=== CLICK EVENT FIRED ===');
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    const isMobile = window.innerWidth <= 768;
                    if (isMobile) {
                        const willOpen = !sidebar.classList.contains('open');
                        sidebar.classList.toggle('open', willOpen);
                        sidebar.classList.toggle('collapsed', !willOpen);
                        localStorage.setItem('sidebarCollapsed', willOpen ? 'false' : 'true');
                        if (sidebarOverlay) sidebarOverlay.classList.toggle('show', willOpen);
                        return;
                    }

                    const isCurrentlyCollapsed = sidebar.classList.contains('collapsed');
                    console.log('Current collapsed state:', isCurrentlyCollapsed);
                    
                    if (isCurrentlyCollapsed) {
                        console.log('Expanding sidebar...');
                        sidebar.classList.remove('collapsed');
                        localStorage.setItem('sidebarCollapsed', 'false');
                    } else {
                        console.log('Collapsing sidebar...');
                        sidebar.classList.add('collapsed');
                        localStorage.setItem('sidebarCollapsed', 'true');
                    }
                    
                    console.log('New collapsed state:', sidebar.classList.contains('collapsed'));
                };
                
                toggleSidebarBtn.addEventListener('click', function(e) {
                    handleToggleClick(e);
                }, true);

                // Close on overlay click (mobile)
                if (sidebarOverlay) {
                    sidebarOverlay.addEventListener('click', function() {
                        sidebar.classList.remove('open');
                        sidebarOverlay.classList.remove('show');
                    });
                }

                // ESC to toggle sidebar (works on both mobile and desktop)
                document.addEventListener('keydown', function(ev) {
                    if (ev.key === 'Escape' || ev.keyCode === 27) {
                        const isMobile = window.innerWidth <= 768;
                        if (isMobile) {
                            // On mobile, close sidebar if open
                            if (sidebar.classList.contains('open')) {
                                sidebar.classList.remove('open');
                                if (sidebarOverlay) sidebarOverlay.classList.remove('show');
                            }
                        } else {
                            // On desktop, toggle collapsed state
                            const isCurrentlyCollapsed = sidebar.classList.contains('collapsed');
                            if (isCurrentlyCollapsed) {
                                sidebar.classList.remove('collapsed');
                                localStorage.setItem('sidebarCollapsed', 'false');
                            } else {
                                sidebar.classList.add('collapsed');
                                localStorage.setItem('sidebarCollapsed', 'true');
                            }
                        }
                    }
                });

                // Handle resize - cleanup mobile classes when returning to desktop
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        sidebar.classList.remove('open');
                        if (sidebarOverlay) sidebarOverlay.classList.remove('show');
                    }
                });
                
                // Debug: log current state
                console.log('Sidebar initialized successfully');
                console.log('Initial collapsed state:', sidebar.classList.contains('collapsed'));
                console.log('Initial width:', sidebar.offsetWidth);
                
                // Add global function for debugging
                window.debugSidebar = function() {
                    console.log('=== SIDEBAR DEBUG INFO ===');
                    console.log('Has collapsed class:', sidebar.classList.contains('collapsed'));
                    console.log('Current width:', sidebar.offsetWidth);
                    console.log('Computed width:', window.getComputedStyle(sidebar).width);
                    console.log('localStorage value:', localStorage.getItem('sidebarCollapsed'));
                    console.log('All classes:', Array.from(sidebar.classList));
                };
                
                window.resetSidebar = function() {
                    localStorage.removeItem('sidebarCollapsed');
                    sidebar.classList.remove('collapsed');
                    console.log('‚úÖ Sidebar reset! Reload the page.');
                };
                
                console.log('üí° Type debugSidebar() to see current state');
                console.log('üí° Type resetSidebar() to reset and reload');
            } else {
                console.error('‚ùå ERROR: Sidebar or toggle button not found!');
                if (!toggleSidebarBtn) {
                    console.error('Toggle button element is missing!');
                }
                if (!sidebar) console.error('Sidebar element is missing!');
            }
            
            // Logout Button Handler
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Clear all session data
                    localStorage.clear();
                    sessionStorage.clear();
                    
                    // Show notification
                    if (window.showInfo) {
                        showInfo('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
                    }
                    
                    // Redirect to login page after a short delay
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 500);
                });
            }
            
            // Notifications Modal logic
            const openNotificationsBtn = document.getElementById('openNotifications');
            const notificationsModal = document.getElementById('notificationsModal');
            const notificationsClose = document.getElementById('notificationsClose');
            const notificationsList = document.getElementById('notificationsList');
            const notificationsCount = document.getElementById('notificationsCount');
            const notifFilterAll = document.getElementById('notifFilterAll');
            const notifFilterImportant = document.getElementById('notifFilterImportant');
            const notifFilterSystem = document.getElementById('notifFilterSystem');
            const notificationsMarkRead = document.getElementById('notificationsMarkRead');

            const NotificationType = {
                IMPORTANT: 'important',
                SYSTEM: 'system',
                INFO: 'info'
            };

            let notifications = [
                { id: 1, type: NotificationType.IMPORTANT, title: '–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', text: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ivan.petrov –¥–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.', time: '2 –º–∏–Ω –Ω–∞–∑–∞–¥', unread: true },
                { id: 2, type: NotificationType.SYSTEM, title: '–°–∏—Å—Ç–µ–º–Ω—ã–π –ª–æ–≥', text: '–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤ —Ä–∞–∑–¥–µ–ª–µ –ü–ª–∞—Ç–µ–∂–∏.', time: '15 –º–∏–Ω –Ω–∞–∑–∞–¥', unread: true },
                { id: 3, type: NotificationType.INFO, title: '–û—Ç—á–µ—Ç –≥–æ—Ç–æ–≤', text: '–ì–æ–¥–æ–≤–æ–π –æ—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω.', time: '–í—á–µ—Ä–∞, 18:45', unread: false }
            ];
            let activeFilter = 'all';

            function renderNotifications() {
                if (!notificationsList) return;
                const items = notifications
                    .filter(n => activeFilter === 'all' || n.type === activeFilter)
                    .map(n => {
                        const color = n.type === NotificationType.IMPORTANT ? '#ef4444' : (n.type === NotificationType.SYSTEM ? '#22d3ee' : '#8b5cf6');
                        return `
                        <div style="display:flex; gap:12px; align-items:flex-start; padding:12px 14px; border:1px solid rgba(0,0,0,.08); border-radius:12px; margin-bottom:10px; background:${n.unread ? 'rgba(102,126,234,0.08)' : 'transparent'};">
                            <div style="width:36px; height:36px; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#fff; background:${color}; box-shadow:0 6px 16px rgba(0,0,0,.15)">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 22a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2zm6-6V11a6 6 0 1 0-12 0v5l-2 2v1h16v-1l-2-2z"/>
                                </svg>
                            </div>
                            <div style="flex:1;">
                                <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
                                    <strong style="color:var(--text-primary)">${n.title}</strong>
                                    <span style="font-size:.8rem; color:var(--text-secondary)">${n.time}</span>
                                </div>
                                <div style="margin-top:4px; color:var(--text-secondary)">${n.text}</div>
                            </div>
                            ${n.unread ? '<span class="badge" style="background:#10b981; height:22px; display:flex; align-items:center;">–ù–æ–≤–∞—è</span>' : ''}
                        </div>`;
                    })
                    .join('');
                notificationsList.innerHTML = items || '<div class="empty-state">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>';

                // Update counter
                const unread = notifications.filter(n => n.unread).length;
                if (notificationsCount) notificationsCount.textContent = String(unread);
                notificationsCount.style.display = unread ? 'flex' : 'none';
            }

            function openNotifications() {
                if (!notificationsModal) return;
                notificationsModal.classList.add('show');
                document.body.style.overflow = 'hidden';
                renderNotifications();
            }

            function closeNotifications() {
                if (!notificationsModal) return;
                notificationsModal.classList.remove('show');
                document.body.style.overflow = '';
            }

            if (openNotificationsBtn) openNotificationsBtn.addEventListener('click', openNotifications);
            if (notificationsClose) notificationsClose.addEventListener('click', closeNotifications);
            if (notificationsModal) notificationsModal.addEventListener('click', (e) => { if (e.target === notificationsModal) closeNotifications(); });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && notificationsModal && notificationsModal.classList.contains('show')) closeNotifications(); });

            if (notifFilterAll) notifFilterAll.addEventListener('click', () => { activeFilter = 'all'; renderNotifications(); });
            if (notifFilterImportant) notifFilterImportant.addEventListener('click', () => { activeFilter = NotificationType.IMPORTANT; renderNotifications(); });
            if (notifFilterSystem) notifFilterSystem.addEventListener('click', () => { activeFilter = NotificationType.SYSTEM; renderNotifications(); });
            if (notificationsMarkRead) notificationsMarkRead.addEventListener('click', () => { notifications = notifications.map(n => ({...n, unread:false})); renderNotifications(); });

            // Expose simple API for future backend hooks
            window.AdminNotifications = {
                push: function(n) { notifications.unshift({ id: Date.now(), unread: true, ...n }); renderNotifications(); },
                markAllRead: function() { notifications = notifications.map(n => ({...n, unread:false})); renderNotifications(); },
                set: function(list) { notifications = list || []; renderNotifications(); }
            };

            // Account Settings Modal
            const accountProfileBtn = document.getElementById('accountProfileBtn');
            const accountModal = document.getElementById('accountModal');
            const accountModalClose = document.getElementById('accountModalClose');
            const accountModalCancel = document.getElementById('accountModalCancel');
            const accountModalSave = document.getElementById('accountModalSave');
            
            function openAccountModal() {
                if (accountModal) {
                    accountModal.classList.add('show');
                    document.body.style.overflow = 'hidden';
                    
                    // Load current settings
                    const savedLang = localStorage.getItem('language') || 'ru';
                    const savedTheme = localStorage.getItem('theme') || 'light';
                    const langSelect = document.getElementById('accountLanguage');
                    const themeSelect = document.getElementById('accountTheme');
                    
                    if (langSelect) langSelect.value = savedLang;
                    if (themeSelect) themeSelect.value = savedTheme;
                }
            }
            
            function closeAccountModal() {
                if (accountModal) {
                    accountModal.classList.remove('show');
                    document.body.style.overflow = '';
                }
            }
            
            if (accountProfileBtn) {
                accountProfileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    openAccountModal();
                });
            }
            
            if (accountModalClose) {
                accountModalClose.addEventListener('click', closeAccountModal);
            }
            
            if (accountModalCancel) {
                accountModalCancel.addEventListener('click', closeAccountModal);
            }
            
            if (accountModal) {
                accountModal.addEventListener('click', function(e) {
                    if (e.target === accountModal) {
                        closeAccountModal();
                    }
                });
            }
            
            if (accountModalSave) {
                accountModalSave.addEventListener('click', function() {
                    const currentPassword = document.getElementById('currentPassword')?.value;
                    const newPassword = document.getElementById('newPassword')?.value;
                    const confirmPassword = document.getElementById('confirmPassword')?.value;
                    const langSelect = document.getElementById('accountLanguage');
                    const themeSelect = document.getElementById('accountTheme');
                    
                    // Save language and theme
                    if (langSelect) {
                        const lang = langSelect.value;
                        localStorage.setItem('language', lang);
                        if (window.i18n) {
                            window.i18n.applyLanguage(lang);
                        }
                    }
                    
                    if (themeSelect) {
                        const theme = themeSelect.value;
                        if (theme !== 'auto') {
                            localStorage.setItem('theme', theme);
                            document.documentElement.setAttribute('data-theme', theme);
                            
                            // Update theme toggle icon
                            const themeToggle = document.getElementById('themeToggle');
                            if (themeToggle) {
                                const lightIcon = themeToggle.querySelector('.theme-icon-light');
                                const darkIcon = themeToggle.querySelector('.theme-icon-dark');
                                if (theme === 'dark') {
                                    if (lightIcon) lightIcon.style.display = 'none';
                                    if (darkIcon) darkIcon.style.display = 'block';
                                } else {
                                    if (lightIcon) lightIcon.style.display = 'block';
                                    if (darkIcon) darkIcon.style.display = 'none';
                                }
                            }
                        }
                    }
                    
                    // Handle password change
                    if (newPassword && confirmPassword) {
                        if (newPassword !== confirmPassword) {
                            if (window.showError) {
                                showError('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                            }
                            return;
                        }
                        if (newPassword.length < 6) {
                            if (window.showError) {
                                showError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤!');
                            }
                            return;
                        }
                        // Here you would send password change request to server
                        if (window.showSuccess) {
                            showSuccess('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω!');
                        }
                    }
                    
                    if (window.showSuccess) {
                        showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                    }
                    
                    // Clear password fields
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    
                    closeAccountModal();
                });
            }
            
            // Close modal on ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && accountModal && accountModal.classList.contains('show')) {
                    closeAccountModal();
                }
            });
        });
    </script>
</body>
</html>




