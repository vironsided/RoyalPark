[1mdiff --git a/Application/Backend/app/routers/api_readings.py b/Application/Backend/app/routers/api_readings.py[m
[1mindex cc7b027..a4f4af9 100644[m
[1m--- a/Application/Backend/app/routers/api_readings.py[m
[1m+++ b/Application/Backend/app/routers/api_readings.py[m
[36m@@ -28,6 +28,144 @@[m [mdef money(x: Decimal) -> Decimal:[m
     return x.quantize(Decimal("0.01"), rounding=ROUND_HALF_UP)[m
 [m
 [m
[32m+[m[32mdef _upsert_auto_sewerage_line_for_invoice([m
[32m+[m[32m    db: Session,[m
[32m+[m[32m    inv: Invoice,[m
[32m+[m[32m    all_period_readings: list[MeterReading],[m
[32m+[m[32m) -> None:[m
[32m+[m[32m    """[m
[32m+[m[32m    –ê–≤—Ç–æ-–∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–∫ % –æ—Ç –≤–æ–¥—ã:[m
[32m+[m[32m    - –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ SEWERAGE-–ø–æ–∫–∞–∑–∞–Ω–∏—è, –∞–≤—Ç–æ-—Å—Ç—Ä–æ–∫—É —É–¥–∞–ª—è–µ–º;[m
[32m+[m[32m    - –∏–Ω–∞—á–µ —Å—á–∏—Ç–∞–µ–º –ø–æ WATER-—Ç–∞—Ä–∏—Ñ–∞–º (Tariff.sewerage_percent).[m
[32m+[m[32m    """[m
[32m+[m[32m    if not inv or not inv.id:[m
[32m+[m[32m        return[m
[32m+[m
[32m+[m[32m    readings = all_period_readings or [][m
[32m+[m[32m    has_real_sewerage = any([m
[32m+[m[32m        (rd.resident_meter and rd.resident_meter.meter_type == MeterType.SEWERAGE)[m
[32m+[m[32m        for rd in readings[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    auto_line = ([m
[32m+[m[32m        db.query(InvoiceLine)[m
[32m+[m[32m        .filter([m
[32m+[m[32m            InvoiceLine.invoice_id == inv.id,[m
[32m+[m[32m            InvoiceLine.meter_reading_id.is_(None),[m
[32m+[m[32m            InvoiceLine.description.ilike("–ö–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è%"),[m
[32m+[m[32m        )[m
[32m+[m[32m        .first()[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    if has_real_sewerage:[m
[32m+[m[32m        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º WATER-—Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ –∏—Å—Ö–æ–¥–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∏–∑ MeterReading.[m
[32m+[m[32m        for rd in readings:[m
[32m+[m[32m            if rd.resident_meter and rd.resident_meter.meter_type == MeterType.WATER:[m
[32m+[m[32m                line = ([m
[32m+[m[32m                    db.query(InvoiceLine)[m
[32m+[m[32m                    .filter(InvoiceLine.invoice_id == inv.id, InvoiceLine.meter_reading_id == rd.id)[m
[32m+[m[32m                    .first()[m
[32m+[m[32m                )[m
[32m+[m[32m                if line:[m
[32m+[m[32m                    line.amount_net = money(Decimal(str(rd.amount_net or 0)))[m
[32m+[m[32m                    line.amount_vat = money(Decimal(str(rd.amount_vat or 0)))[m
[32m+[m[32m                    line.amount_total = money(Decimal(str(rd.amount_total or 0)))[m
[32m+[m[32m                    line.description = f"–í–æ–¥–∞ {float(Decimal(str(rd.consumption or 0)))} –º¬≥"[m
[32m+[m[32m        if auto_line:[m
[32m+[m[32m            db.delete(auto_line)[m
[32m+[m[32m        return[m
[32m+[m
[32m+[m[32m    water_readings = [[m
[32m+[m[32m        rd for rd in readings[m
[32m+[m[32m        if rd.resident_meter and rd.resident_meter.meter_type == MeterType.WATER[m
[32m+[m[32m    ][m
[32m+[m[32m    if not water_readings:[m
[32m+[m[32m        if auto_line:[m
[32m+[m[32m            db.delete(auto_line)[m
[32m+[m[32m        return[m
[32m+[m
[32m+[m[32m    sew_net = Decimal("0")[m
[32m+[m[32m    sew_vat = Decimal("0")[m
[32m+[m[32m    sew_total = Decimal("0")[m
[32m+[m[32m    sewer_cons = Decimal("0")[m
[32m+[m
[32m+[m[32m    for rd in water_readings:[m
[32m+[m[32m        line = ([m
[32m+[m[32m            db.query(InvoiceLine)[m
[32m+[m[32m            .filter(InvoiceLine.invoice_id == inv.id, InvoiceLine.meter_reading_id == rd.id)[m
[32m+[m[32m            .first()[m
[32m+[m[32m        )[m
[32m+[m[32m        if not line:[m
[32m+[m[32m            continue[m
[32m+[m
[32m+[m[32m        base_net = money(Decimal(str(rd.amount_net or 0)))[m
[32m+[m[32m        base_vat = money(Decimal(str(rd.amount_vat or 0)))[m
[32m+[m[32m        base_total = money(Decimal(str(rd.amount_total or 0)))[m
[32m+[m
[32m+[m[32m        t = db.get(Tariff, rd.tariff_id) if rd.tariff_id else None[m
[32m+[m[32m        percent = Decimal(str(getattr(t, "sewerage_percent", 0) or 0))[m
[32m+[m[32m        if percent <= 0:[m
[32m+[m[32m            line.amount_net = base_net[m
[32m+[m[32m            line.amount_vat = base_vat[m
[32m+[m[32m            line.amount_total = base_total[m
[32m+[m[32m            line.description = f"–í–æ–¥–∞ {float(Decimal(str(rd.consumption or 0)))} –º¬≥"[m
[32m+[m[32m            continue[m
[32m+[m
[32m+[m[32m        k = percent / Decimal("100")[m
[32m+[m[32m        consumption = Decimal(str(rd.consumption or 0))[m
[32m+[m
[32m+[m[32m        if getattr(t, "customer_type", None) == CustomerType.INDIVIDUAL:[m
[32m+[m[32m            # –î–ª—è —Ñ–∏–∑–ª–∏—Ü –¥–µ–ª–∏–º WATER-—Å—Ç—Ä–æ–∫—É –Ω–∞ –≤–æ–¥—É –∏ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—é (–±–µ–∑ —Ä–æ—Å—Ç–∞ total).[m
[32m+[m[32m            new_net = money(base_net * (Decimal("1") - k))[m
[32m+[m[32m            new_vat = money(base_vat * (Decimal("1") - k))[m
[32m+[m[32m            new_total = money(base_total * (Decimal("1") - k))[m
[32m+[m
[32m+[m[32m            line.amount_net = new_net[m
[32m+[m[32m            line.amount_vat = new_vat[m
[32m+[m[32m            line.amount_total = new_total[m
[32m+[m
[32m+[m[32m            sew_net += (base_net - new_net)[m
[32m+[m[32m            sew_vat += (base_vat - new_vat)[m
[32m+[m[32m            sew_total += (base_total - new_total)[m
[32m+[m
[32m+[m[32m            water_display_cons = consumption * (Decimal("1") - k)[m
[32m+[m[32m            sewer_display_cons = consumption * k[m
[32m+[m[32m            line.description = f"–í–æ–¥–∞ {float(water_display_cons)} –º¬≥"[m
[32m+[m[32m            sewer_cons += sewer_display_cons[m
[32m+[m[32m        else:[m
[32m+[m[32m            # –î–ª—è —é—Ä–ª–∏—Ü WATER –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É.[m
[32m+[m[32m            line.amount_net = base_net[m
[32m+[m[32m            line.amount_vat = base_vat[m
[32m+[m[32m            line.amount_total = base_total[m
[32m+[m
[32m+[m[32m            sew_net += money(base_net * k)[m
[32m+[m[32m            sew_vat += money(base_vat * k)[m
[32m+[m[32m            sew_total += money(base_total * k)[m
[32m+[m[32m            line.description = f"–í–æ–¥–∞ {float(consumption)} –º¬≥"[m
[32m+[m[32m            sewer_cons += consumption * k[m
[32m+[m
[32m+[m[32m    if sew_total <= 0:[m
[32m+[m[32m        if auto_line:[m
[32m+[m[32m            db.delete(auto_line)[m
[32m+[m[32m        return[m
[32m+[m
[32m+[m[32m    desc = f"–ö–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è  {float(sewer_cons)} –º¬≥"[m
[32m+[m[32m    if auto_line:[m
[32m+[m[32m        auto_line.description = desc[m
[32m+[m[32m        auto_line.amount_net = money(sew_net)[m
[32m+[m[32m        auto_line.amount_vat = money(sew_vat)[m
[32m+[m[32m        auto_line.amount_total = money(sew_total)[m
[32m+[m[32m    else:[m
[32m+[m[32m        db.add(InvoiceLine([m
[32m+[m[32m            invoice_id=inv.id,[m
[32m+[m[32m            meter_reading_id=None,[m
[32m+[m[32m            description=desc,[m
[32m+[m[32m            amount_net=money(sew_net),[m
[32m+[m[32m            amount_vat=money(sew_vat),[m
[32m+[m[32m            amount_total=money(sew_total),[m
[32m+[m[32m        ))[m
[32m+[m
[32m+[m
 def get_gas_annual_prev(db: Session, meter_id: int, period_start: datetime) -> Decimal:[m
     """–ì–∞–∑: –≥–æ–¥–æ–≤–æ–π –æ–±—ä—ë–º –î–û –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞ (–¥–ª—è –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞)."""[m
     year_start = datetime(period_start.year, 1, 1)[m
[36m@@ -281,6 +419,13 @@[m [mdef list_readings([m
     )[m
     period_readings = readings_q.all()[m
     [m
[32m+[m[32m    # –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ä–µ–∞–ª—å–Ω–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥ —É —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞.[m
[32m+[m[32m    real_sewerage_resident_ids: set[int] = set()[m
[32m+[m[32m    for rd in period_readings:[m
[32m+[m[32m        meter = rd.resident_meter[m
[32m+[m[32m        if meter and meter.meter_type == MeterType.SEWERAGE:[m
[32m+[m[32m            real_sewerage_resident_ids.add(meter.resident_id)[m
[32m+[m
     # –ê–≥—Ä–µ–≥–∞—Ç –ø–æ —Å—á—ë—Ç—á–∏–∫–∞–º[m
     rows: dict[int, dict] = {}[m
     for rd in period_readings:[m
[36m@@ -302,8 +447,42 @@[m [mdef list_readings([m
             "consumption": Decimal("0"),[m
             "total": Decimal("0"),[m
         })[m
[31m-        mrow["consumption"] += Decimal(rd.consumption)[m
[31m-        mrow["total"] += Decimal(rd.amount_total)[m
[32m+[m[32m        cons = Decimal(rd.consumption or 0)[m
[32m+[m[32m        total = Decimal(rd.amount_total or 0)[m
[32m+[m
[32m+[m[32m        # –ï—Å–ª–∏ —É —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ SEWERAGE-—Å—á—ë—Ç—á–∏–∫–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤—Ç–æ-–∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ.[m
[32m+[m[32m        if meter.meter_type == MeterType.WATER and res_id not in real_sewerage_resident_ids:[m
[32m+[m[32m            t = rd.tariff[m
[32m+[m[32m            percent = Decimal(str(getattr(t, "sewerage_percent", 0) or 0)) if t else Decimal("0")[m
[32m+[m[32m            if percent > 0:[m
[32m+[m[32m                k = percent / Decimal("100")[m
[32m+[m[32m                if getattr(t, "customer_type", None) == CustomerType.INDIVIDUAL:[m
[32m+[m[32m                    water_cons = cons * (Decimal("1") - k)[m
[32m+[m[32m                    water_total = money(total * (Decimal("1") - k))[m
[32m+[m[32m                    sewer_cons = cons * k[m
[32m+[m[32m                    sewer_total = money(total - water_total)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    water_cons = cons[m
[32m+[m[32m                    water_total = total[m
[32m+[m[32m                    sewer_cons = cons * k[m
[32m+[m[32m                    sewer_total = money(total * k)[m
[32m+[m
[32m+[m[32m                mrow["consumption"] += water_cons[m
[32m+[m[32m                mrow["total"] += water_total[m
[32m+[m
[32m+[m[32m                auto_sewer = entry.setdefault("auto_sewer", {[m
[32m+[m[32m                    "consumption": Decimal("0"),[m
[32m+[m[32m                    "total": Decimal("0"),[m
[32m+[m[32m                    "unit": "–º¬≥",[m
[32m+[m[32m                })[m
[32m+[m[32m                auto_sewer["consumption"] += sewer_cons[m
[32m+[m[32m                auto_sewer["total"] += sewer_total[m
[32m+[m[32m            else:[m
[32m+[m[32m                mrow["consumption"] += cons[m
[32m+[m[32m                mrow["total"] += total[m
[32m+[m[32m        else:[m
[32m+[m[32m            mrow["consumption"] += cons[m
[32m+[m[32m            mrow["total"] += total[m
 [m
         # –ù—É–∂–Ω–∞ "–ø–æ—Å–ª–µ–¥–Ω—è—è" –∑–∞–ø–∏—Å—å –∑–∞ –ø–µ—Ä–∏–æ–¥ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)[m
         cur_max = entry.get("max_reading_date")[m
[36m@@ -358,6 +537,18 @@[m [mdef list_readings([m
                 "unit": mdata["unit"],[m
                 "total": total,[m
             })[m
[32m+[m
[32m+[m[32m        auto_sewer = data.get("auto_sewer")[m
[32m+[m[32m        if auto_sewer and auto_sewer["total"] > 0:[m
[32m+[m[32m            auto_cons = float(auto_sewer["consumption"])[m
[32m+[m[32m            auto_total = float(auto_sewer["total"])[m
[32m+[m[32m            total_amount += Decimal(auto_total)[m
[32m+[m[32m            meters_list.append({[m
[32m+[m[32m                "type": "–ö–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è",[m
[32m+[m[32m                "consumption": auto_cons,[m
[32m+[m[32m                "unit": auto_sewer["unit"],[m
[32m+[m[32m                "total": auto_total,[m
[32m+[m[32m            })[m
         [m
         result_rows.append({[m
             "resident_id": res_id,[m
[36m@@ -563,6 +754,8 @@[m [mdef get_resident_meters([m
             "existing": bool(existing),[m
             "existing_value": existing_value_float,[m
             "existing_photo_url": existing_photo_url,[m
[32m+[m[32m            "sewerage_percent": float(getattr(tariff_obj, "sewerage_percent", 0) or 0),[m
[32m+[m[32m            "tariff_customer_type": (tariff_obj.customer_type.value if getattr(tariff_obj, "customer_type", None) else None),[m
         })[m
 [m
     return {"meters": meters}[m
[36m@@ -996,7 +1189,10 @@[m [mdef create_readings_internal([m
                     line.amount_net = rd.amount_net[m
                     line.amount_vat = rd.amount_vat[m
                     line.amount_total = rd.amount_total[m
[31m-            [m
[32m+[m
[32m+[m[32m            # –ê–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (–æ—Ç –≤–æ–¥—ã).[m
[32m+[m[32m            _upsert_auto_sewerage_line_for_invoice(db, invoice, all_period_readings)[m
[32m+[m
             # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–∏ —Å—á—ë—Ç–∞ –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫[m
             db.flush()  # –í–∞–∂–Ω–æ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º[m
             totals = db.query([m
[1mdiff --git a/public/admin/content/readings.html b/public/admin/content/readings.html[m
[1mindex 2529a22..5f69f07 100644[m
[1m--- a/public/admin/content/readings.html[m
[1m+++ b/public/admin/content/readings.html[m
[36m@@ -2166,6 +2166,83 @@[m
         return totalNet + vat;[m
     }[m
 [m
[32m+[m[32m    function getWaterBaseValues(row) {[m
[32m+[m[32m        const prev = parseFloat(row.dataset.prevValue || '0');[m
[32m+[m[32m        const input = row.querySelector('.meter-input');[m
[32m+[m[32m        const value = input?.value ? parseFloat(input.value) : null;[m
[32m+[m[32m        if (value === null || Number.isNaN(value)) {[m
[32m+[m[32m            return { consumption: 0, amount: 0 };[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        const consumption = Math.max(0, value - prev);[m
[32m+[m[32m        const tariffSteps = JSON.parse(row.dataset.tariffSteps || '[]');[m
[32m+[m[32m        const vatPercent = parseFloat(row.dataset.vatPercent || '0');[m
[32m+[m[32m        const amount = calculateAmount(consumption, tariffSteps, vatPercent);[m
[32m+[m[32m        return { consumption, amount };[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    function upsertAutoSewerRowForWater(waterRow) {[m
[32m+[m[32m        if (!waterRow) return;[m
[32m+[m[32m        const percent = parseFloat(waterRow.dataset.seweragePercent || '0');[m
[32m+[m[32m        if (!(percent > 0)) return;[m
[32m+[m
[32m+[m[32m        const meterId = waterRow.dataset.meterId;[m
[32m+[m[32m        const customerType = (waterRow.dataset.sewerageCustomerType || '').toUpperCase();[m
[32m+[m[32m        const k = percent / 100;[m
[32m+[m
[32m+[m[32m        const { consumption: baseConsumption, amount: baseAmount } = getWaterBaseValues(waterRow);[m
[32m+[m[32m        let waterConsumption = baseConsumption;[m
[32m+[m[32m        let waterAmount = baseAmount;[m
[32m+[m[32m        let sewerConsumption = baseConsumption * k;[m
[32m+[m[32m        let sewerAmount = baseAmount * k;[m
[32m+[m
[32m+[m[32m        if (customerType === 'INDIVIDUAL') {[m
[32m+[m[32m            waterConsumption = baseConsumption * (1 - k);[m
[32m+[m[32m            waterAmount = baseAmount * (1 - k);[m
[32m+[m[32m            sewerConsumption = baseConsumption * k;[m
[32m+[m[32m            sewerAmount = Math.max(0, baseAmount - waterAmount);[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        const waterConsumptionEl = waterRow.querySelector('.meter-consumption');[m
[32m+[m[32m        const waterAmountEl = waterRow.querySelector('.meter-amount');[m
[32m+[m[32m        if (waterConsumptionEl) waterConsumptionEl.textContent = waterConsumption.toFixed(3);[m
[32m+[m[32m        if (waterAmountEl) waterAmountEl.textContent = waterAmount.toFixed(2);[m
[32m+[m
[32m+[m[32m        let sewerRow = document.querySelector(`#meterTableBody tr.auto-sewer-row[data-linked-water-meter-id="${meterId}"]`);[m
[32m+[m[32m        if (!sewerRow) {[m
[32m+[m[32m            sewerRow = document.createElement('tr');[m
[32m+[m[32m            sewerRow.className = 'auto-sewer-row';[m
[32m+[m[32m            sewerRow.setAttribute('data-linked-water-meter-id', meterId);[m
[32m+[m[32m            sewerRow.innerHTML = `[m
[32m+[m[32m                <td><span class="meter-type-pill">–ö–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–∞–≤—Ç–æ)</span></td>[m
[32m+[m[32m                <td class="auto-sewer-tariff">‚Äî</td>[m
[32m+[m[32m                <td>‚Äî</td>[m
[32m+[m[32m                <td>–æ—Ç –≤–æ–¥—ã</td>[m
[32m+[m[32m                <td><span class="meter-consumption">0.000</span></td>[m
[32m+[m[32m                <td><span class="meter-amount">0.00</span></td>[m
[32m+[m[32m                <td><div class="meter-photo-cell"><span class="meter-photo-placeholder">‚Äî</span></div></td>[m
[32m+[m[32m                <td></td>[m
[32m+[m[32m            `;[m
[32m+[m[32m            waterRow.insertAdjacentElement('afterend', sewerRow);[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        const tariffCell = sewerRow.querySelector('.auto-sewer-tariff');[m
[32m+[m[32m        if (tariffCell) {[m
[32m+[m[32m            const waterTariffName = waterRow.dataset.tariffName || '–í–æ–¥–∞';[m
[32m+[m[32m            tariffCell.textContent = `${waterTariffName} (${percent.toFixed(2)}%)`;[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        const sewerConsumptionEl = sewerRow.querySelector('.meter-consumption');[m
[32m+[m[32m        const sewerAmountEl = sewerRow.querySelector('.meter-amount');[m
[32m+[m[32m        if (sewerConsumptionEl) sewerConsumptionEl.textContent = sewerConsumption.toFixed(3);[m
[32m+[m[32m        if (sewerAmountEl) sewerAmountEl.textContent = sewerAmount.toFixed(2);[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    function refreshAllAutoSewerRows() {[m
[32m+[m[32m        const waterRows = Array.from(document.querySelectorAll('#meterTableBody tr[data-meter-id][data-meter-type="WATER"]'));[m
[32m+[m[32m        waterRows.forEach(upsertAutoSewerRowForWater);[m
[32m+[m[32m    }[m
[32m+[m
     function renderMeterTable(meters) {[m
         const tbody = document.getElementById('meterTableBody');[m
         if (!tbody) return;[m
[36m@@ -2180,6 +2257,7 @@[m
             return;[m
         }[m
 [m
[32m+[m[32m        const hasRealSewerMeter = meters.some(m => m.type === 'SEWERAGE');[m
         tbody.innerHTML = meters.map(meter => {[m
             // prev_value - —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –î–û –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞ (–∏–ª–∏ initial_reading)[m
             // existing_value - —ç—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –ó–ê —ç—Ç–æ—Ç –º–µ—Å—è—Ü (–µ—Å–ª–∏ –µ—Å—Ç—å)[m
[36m@@ -2284,6 +2362,10 @@[m
 [m
             const tariffStepsJson = JSON.stringify(meter.tariff_steps || []);[m
             const vatPercent = meter.vat_percent || 0;[m
[32m+[m[32m            const seweragePercent = (!hasRealSewerMeter && meter.type === 'WATER')[m
[32m+[m[32m                ? (parseFloat(meter.sewerage_percent || 0) || 0)[m
[32m+[m[32m                : 0;[m
[32m+[m[32m            const sewerageCustomerType = meter.tariff_customer_type || '';[m
 [m
             // –ï—Å–ª–∏ –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞[m
             const inputValue = (existing !== null && existing !== undefined) ? existing.toFixed(3) : '';[m
[36m@@ -2307,7 +2389,10 @@[m
                         data-tariff-steps='${tariffStepsJson}'[m
                         data-vat-percent="${vatPercent}"[m
                       