# üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ RoyalPark

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–≥–∏–±—Ä–∏–¥–Ω—É—é —Å–∏—Å—Ç–µ–º—É** —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–ª—ã–º –∫–æ–º–ø–ª–µ–∫—Å–æ–º —Å –¥–≤—É–º—è –ø–æ–¥—Ö–æ–¥–∞–º–∏ –∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É:

1. **Jinja2-based Admin Panel** (—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π SSR)
   - –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Jinja2 —à–∞–±–ª–æ–Ω—ã
   - –§–æ—Ä–º—ã –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏

2. **REST API** (–¥–ª—è SPA —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
   - JSON endpoints
   - Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Backend

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `app/main.py`
- **FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π middleware
- **CORS** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è localhost:3000 –∏ localhost:8000
- **SessionMiddleware** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏
- **Static files** –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`/static`, `/uploads`)
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î** —Å bootstrap —Å—Ö–µ–º–æ–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

#### `app/models.py`
**–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**
- `User` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (ROOT, ADMIN, OPERATOR, RESIDENT)
- `Block` - –±–ª–æ–∫–∏/–∑–¥–∞–Ω–∏—è
- `Resident` - —Ä–µ–∑–∏–¥–µ–Ω—Ç—ã (–∫–≤–∞—Ä—Ç–∏—Ä—ã/–¥–æ–º–∞)
- `ResidentMeter` - —Å—á—ë—Ç—á–∏–∫–∏ —Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–≤
- `Tariff` / `TariffStep` - —Ç–∞—Ä–∏—Ñ—ã —Å –º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- `MeterReading` - –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å—á—ë—Ç—á–∏–∫–æ–≤
- `Invoice` / `InvoiceLine` - —Å—á–µ—Ç–∞
- `Payment` / `PaymentApplication` - –ø–ª–∞—Ç–µ–∂–∏ –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —Å—á–µ—Ç–∞–º
- `ResidentService` - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ (SERVICE, RENT)
- `Notification` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `QRToken` - —Ç–æ–∫–µ–Ω—ã –¥–ª—è QR-–∫–æ–¥–æ–≤
- `ReadingLog` - –ª–æ–≥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–∫–∞–∑–∞–Ω–∏–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ relationships (lazy loading)
- ‚úÖ Enum —Ç–∏–ø—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ —Ä–æ–ª–µ–π
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (UniqueConstraint)
- ‚úÖ –ö–∞—Å–∫–∞–¥–Ω—ã–µ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ soft-delete —á–µ—Ä–µ–∑ `is_active`

#### `app/database.py`
- **SQLAlchemy 2.0** —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- **PostgreSQL** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **SessionLocal** –¥–ª—è dependency injection
- **DeclarativeBase** –¥–ª—è –º–æ–¥–µ–ª–µ–π

#### `app/security.py`
- **Argon2** —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **Session management** —á–µ—Ä–µ–∑ cookies
- **URLSafeSerializer** –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ —Å–µ—Å—Å–∏–∏
- Cookie –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: httponly, samesite=lax

#### `app/deps.py`
- **Dependency injection** –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `get_current_user` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `require_any_role` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- `require_root` - –ø—Ä–æ–≤–µ—Ä–∫–∞ ROOT –ø—Ä–∞–≤
- `can_manage_user` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### `app/config.py`
- **Pydantic Settings** –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î (PostgreSQL)
- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Å–µ—Å—Å–∏–π
- Root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

## üîÄ –†–æ—É—Ç–µ—Ä—ã

### Jinja2-based —Ä–æ—É—Ç–µ—Ä—ã (SSR)
–ò—Å–ø–æ–ª—å–∑—É—é—Ç `Jinja2Templates` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ HTML:

| –†–æ—É—Ç–µ—Ä | –ü—Ä–µ—Ñ–∏–∫—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `auth_routes.py` | `/` | –õ–æ–≥–∏–Ω/–ª–æ–≥–∞—É—Ç, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è |
| `dashboard.py` | `/` | –ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å |
| `users.py` | `/users` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| `blocks.py` | `/blocks` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞–º–∏ |
| `tariffs.py` | `/tariffs` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏ |
| `residents.py` | `/residents` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞–º–∏ |
| `readings.py` | `/readings` | –ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á—ë—Ç—á–∏–∫–æ–≤ |
| `tenants.py` | `/tenants` | –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã |
| `invoices.py` | `/invoices` | –°—á–µ—Ç–∞ |
| `payments.py` | `/payments` | –ü–ª–∞—Ç–µ–∂–∏ |
| `notifications.py` | `/notifications` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `resident_portal.py` | `/resident` | –ü–æ—Ä—Ç–∞–ª —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ |

**–ü–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–±–æ—Ç—ã:**
```python
@router.get("/", response_class=HTMLResponse)
def list_items(request: Request, user: User = Depends(get_current_user), db: Session = Depends(get_db)):
    items = db.query(Model).all()
    return templates.TemplateResponse("template.html", {
        "request": request,
        "items": items,
        "user": user
    })
```

### REST API —Ä–æ—É—Ç–µ—Ä—ã
–ò—Å–ø–æ–ª—å–∑—É—é—Ç Pydantic –º–æ–¥–µ–ª–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç JSON:

| –†–æ—É—Ç–µ—Ä | –ü—Ä–µ—Ñ–∏–∫—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `api_users.py` | `/api/users` | CRUD –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `api_blocks.py` | `/api/blocks` | CRUD –±–ª–æ–∫–æ–≤ |
| `api_tariffs.py` | `/api/tariffs` | CRUD —Ç–∞—Ä–∏—Ñ–æ–≤ |
| `api_residents.py` | `/api/residents` | CRUD —Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–≤ |
| `api_readings.py` | `/api/readings` | CRUD –ø–æ–∫–∞–∑–∞–Ω–∏–π |
| `api_tenants.py` | `/api/tenants` | CRUD –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ |
| `api_invoices.py` | `/api/invoices` | CRUD —Å—á–µ—Ç–æ–≤ |
| `api_payments.py` | `/api/payments` | CRUD –ø–ª–∞—Ç–µ–∂–µ–π |
| `api_notifications.py` | `/api/notifications` | CRUD —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `api_dashboard.py` | `/api/dashboard` | –î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ |
| `api_logs.py` | `/api/logs` | –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã |
| `api_qr.py` | `/api/qr` | QR —Ç–æ–∫–µ–Ω—ã |
| `api_payment.py` | `/api/payment` | –û–¥–∏–Ω–æ—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂ |
| `api_resident_dashboard.py` | `/api/resident/dashboard` | –î–∞—à–±–æ—Ä–¥ —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ |

**–ü–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–±–æ—Ç—ã:**
```python
@router.get("/", response_model=ListOut)
def list_items(
    db: Session = Depends(get_db),
    user: User = Depends(get_current_user),
    page: int = Query(1, ge=1),
    per_page: int = Query(25, ge=1, le=100)
):
    # –õ–æ–≥–∏–∫–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
    return {"items": items, "total": total, ...}
```

---

## üîê –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
1. **ROOT** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø, –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏
2. **ADMIN** - –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ OPERATOR –∏ RESIDENT
3. **OPERATOR** - –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã
4. **RESIDENT** - —Ä–µ–∑–∏–¥–µ–Ω—Ç/–∂–∏—Ç–µ–ª—å

### –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **Session-based** —á–µ—Ä–µ–∑ cookies
- **SessionMiddleware** –æ—Ç Starlette
- Cookie —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω —Å `user_id`
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏: 8 —á–∞—Å–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
- `get_current_user` - –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `require_any_role(*roles)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- `can_manage_user(target, actor)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

---

## üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (–¥–µ—Ç–∞–ª—å–Ω–æ)

### User (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- `username` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω
- `password_hash` - —Ö–µ—à –ø–∞—Ä–æ–ª—è (Argon2)
- `role` - —Ä–æ–ª—å (RoleEnum)
- `full_name`, `phone`, `email` - –∫–æ–Ω—Ç–∞–∫—Ç—ã
- `avatar_path` - –ø—É—Ç—å –∫ –∞–≤–∞—Ç–∞—Ä—É
- `require_password_change` - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- `temp_password_plain` - –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å (–æ—Ç–∫—Ä—ã—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º)
- `is_active` - –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `resident_links` - —Å–≤—è–∑—å —Å —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞–º–∏ (M2M)

### Resident (–†–µ–∑–∏–¥–µ–Ω—Ç—ã)
- `block_id` - –±–ª–æ–∫/–∑–¥–∞–Ω–∏–µ
- `unit_number` - –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã/–¥–æ–º–∞
- `resident_type` - —Ç–∏–ø (OWNER, TENANT, SUBTENANT, OFFICE)
- `customer_type` - —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞ (INDIVIDUAL, LEGAL)
- `status` - —Å—Ç–∞—Ç—É—Å (ACTIVE, INACTIVE)
- `owner_full_name`, `owner_phone`, `owner_email` - –¥–∞–Ω–Ω—ã–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `meters` - —Å–ø–∏—Å–æ–∫ —Å—á—ë—Ç—á–∏–∫–æ–≤
- `tenant_links` - —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (M2M)

### Tariff (–¢–∞—Ä–∏—Ñ—ã)
- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
- `meter_type` - —Ç–∏–ø —Å—á—ë—Ç—á–∏–∫–∞ (ELECTRIC, GAS, WATER, etc.)
- `customer_type` - —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞
- `vat_percent` - –ø—Ä–æ—Ü–µ–Ω—Ç –ù–î–°
- `steps` - —Å—Ç—É–ø–µ–Ω–∏ —Ç–∞—Ä–∏—Ñ–∞ (TariffStep)

### TariffStep (–°—Ç—É–ø–µ–Ω–∏ —Ç–∞—Ä–∏—Ñ–∞)
- `from_value` / `to_value` - –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
- `from_date` / `to_date` - –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –¥–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ (CONSTRUCTION)
- `price` - —Ü–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É

### MeterReading (–ü–æ–∫–∞–∑–∞–Ω–∏—è)
- `resident_meter_id` - —Å—á—ë—Ç—á–∏–∫
- `reading_date` - –¥–∞—Ç–∞ –ø–æ–∫–∞–∑–∞–Ω–∏—è
- `value` - –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
- `consumption` - –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ (—Ä–∞–∑–Ω–∏—Ü–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º)
- `tariff_id` - —Ç–∞—Ä–∏—Ñ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫–∞–∑–∞–Ω–∏—è
- `amount_net`, `amount_vat`, `amount_total` - —Å—É–º–º—ã

### Invoice (–°—á–µ—Ç–∞)
- `resident_id` - —Ä–µ–∑–∏–¥–µ–Ω—Ç
- `number` - –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞
- `status` - —Å—Ç–∞—Ç—É—Å (DRAFT, ISSUED, PARTIAL, PAID, etc.)
- `due_date` - —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã
- `period_year`, `period_month` - –ø–µ—Ä–∏–æ–¥
- `lines` - —Å—Ç—Ä–æ–∫–∏ —Å—á–µ—Ç–∞ (InvoiceLine)

### Payment (–ü–ª–∞—Ç–µ–∂–∏)
- `resident_id` - —Ä–µ–∑–∏–¥–µ–Ω—Ç
- `received_at` - –¥–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è
- `amount_total` - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
- `method` - —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (CASH, CARD, TRANSFER, ONLINE)
- `applications` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —Å—á–µ—Ç–∞–º (PaymentApplication)
- `applied_total` - —Å—É–º–º–∞ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω–∞—è –∫ —Å—á–µ—Ç–∞–º (property)
- `leftover` - –æ—Å—Ç–∞—Ç–æ–∫ (property)

---

## üéØ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –¢–∞—Ä–∏—Ñ—ã
- **–ú–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞** (TariffStep)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥** (SERVICE, RENT, CONSTRUCTION)
- **–ù–î–°** —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- –†–∞–∑–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è **INDIVIDUAL** –∏ **LEGAL**

### –ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á—ë—Ç—á–∏–∫–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è** (—Ä–∞–∑–Ω–∏—Ü–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º)
- **–†–∞—Å—á—ë—Ç —Å—É–º–º—ã** –ø–æ —Ç–∞—Ä–∏—Ñ—É –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫–∞–∑–∞–Ω–∏—è
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** (ReadingLog)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–æ–ø–æ—Ä–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è** (initial_reading)

### –°—á–µ—Ç–∞
- **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ –ø–µ—Ä–∏–æ–¥—É** (resident_id + period_year + period_month)
- **–°—Ç—Ä–æ–∫–∏ —Å—á–µ—Ç–∞** –º–æ–≥—É—Ç –±—ã—Ç—å:
  - –°–≤—è–∑–∞–Ω—ã —Å –ø–æ–∫–∞–∑–∞–Ω–∏–µ–º (`meter_reading_id`)
  - –ò–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏ (–±–µ–∑ –ø–æ–∫–∞–∑–∞–Ω–∏—è)
- **–°—Ç–∞—Ç—É—Å—ã**: DRAFT ‚Üí ISSUED ‚Üí PARTIAL ‚Üí PAID

### –ü–ª–∞—Ç–µ–∂–∏
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —Å—á–µ—Ç–∞–º** —á–µ—Ä–µ–∑ PaymentApplication
- **–û—Å—Ç–∞—Ç–æ–∫ –ø–ª–∞—Ç–µ–∂–∞** –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω—ë–Ω –∫ –¥—Ä—É–≥–∏–º —Å—á–µ—Ç–∞–º
- **–ú–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã**: –Ω–∞–ª–∏—á–Ω—ã–µ, –∫–∞—Ä—Ç–∞, –ø–µ—Ä–µ–≤–æ–¥, –æ–Ω–ª–∞–π–Ω

---

## üîß –£—Ç–∏–ª–∏—Ç—ã

### `app/utils.py`
- `generate_temp_password()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π

### Bootstrap —Å—Ö–µ–º–∞ (`main.py`)
- **–ú—è–≥–∫–∏–µ DDL** –∏–∑–º–µ–Ω–µ–Ω–∏—è (IF NOT EXISTS)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –±–µ–∑–æ–ø–∞—Å–Ω–æ
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ endpoints
–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö API —Ä–æ—É—Ç–µ—Ä–∞—Ö –µ—Å—Ç—å **–ø—É–±–ª–∏—á–Ω—ã–µ endpoints** (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- `/api/users/public`
- `/api/users/me/public`
- `/api/users/{id}/public`

**TODO:** –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É SPA –∏ backend.

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≤ Jinja —Ä–æ—É—Ç–µ—Ä–∞—Ö, –∏ –≤ API —Ä–æ—É—Ç–µ—Ä–∞—Ö:
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞–º–∏
- –†–∞–±–æ—Ç–∞ —Å–æ —Å—á–µ—Ç–∞–º–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Backend (requirements.txt)
- `fastapi==0.115.2` - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `uvicorn[standard]==0.30.6` - ASGI —Å–µ—Ä–≤–µ—Ä
- `SQLAlchemy==2.0.44` - ORM
- `psycopg2-binary==2.9.11` - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
- `passlib[bcrypt]==1.7.4` - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Argon2)
- `jinja2==3.1.4` - —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä
- `pydantic[email]` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `argon2-cffi` - Argon2 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### Frontend (package.json)
- `express` - Node.js —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
- `bootstrap` - CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `cors` - CORS middleware

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è REST API

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ API endpoints
–í—Å–µ API endpoints —É–∂–µ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `/api/` –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.

### 2. –ü–∞–≥–∏–Ω–∞—Ü–∏—è
–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö endpoints (–Ω–∞–ø—Ä–∏–º–µ—Ä, `api_users.py`):
```python
page: int = Query(1, ge=1)
per_page: int = Query(25, ge=1, le=100)
```

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### 4. –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å:

#### a) –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ endpoints
- –£–±—Ä–∞—Ç—å –≤—Å–µ `/public` –º–∞—Ä—à—Ä—É—Ç—ã
- –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ endpoints

#### b) –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
–°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–µ –º–æ–¥–µ–ª–∏ –æ—Ç–≤–µ—Ç–æ–≤:
```python
class APIResponse(BaseModel):
    success: bool
    data: Any
    message: Optional[str] = None
    errors: Optional[List[str]] = None
```

#### c) –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫:
```python
@app.exception_handler(HTTPException)
async def http_exception_handler(request, exc):
    return JSONResponse(
        status_code=exc.status_code,
        content={"success": False, "message": exc.detail}
    )
```

#### d) –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API
–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π: `/api/v1/users`

#### e) –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Swagger UI –ø–æ –∞–¥—Ä–µ—Å—É `/docs`

#### f) –í—ã–Ω–µ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å–µ—Ä–≤–∏—Å—ã
–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `app/services/`:
- `user_service.py`
- `resident_service.py`
- `invoice_service.py`
- –∏ —Ç.–¥.

---

## üìù –®–∞–±–ª–æ–Ω—ã (Templates)

–í—Å–µ Jinja2 —à–∞–±–ª–æ–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `app/templates/`:
- `base.html` - –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
- `login.html` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
- `users.html`, `residents.html`, `invoices.html` - —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `resident_*.html` - —à–∞–±–ª–æ–Ω—ã –¥–ª—è –ø–æ—Ä—Ç–∞–ª–∞ —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### PostgreSQL
- **Host:** 127.0.0.1
- **Port:** 5432
- **Database:** fast1 (–∏–∑ config.py)
- **User:** postgres
- **Password:** admin

### –ú–∏–≥—Ä–∞—Ü–∏–∏
–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **bootstrap —Å—Ö–µ–º–∞** –≤ `main.py` (run_bootstrap_schema).
–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Alembic** –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π.

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

1. ‚úÖ **–ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** Jinja –∏ REST API —Ä–æ—É—Ç–µ—Ä–æ–≤
2. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ relationships** –≤ –º–æ–¥–µ–ª—è—Ö
3. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - Argon2, session management
4. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Pydantic
5. ‚úÖ **–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. ‚úÖ **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤, —Å—á–µ—Ç–æ–≤, –ø–ª–∞—Ç–µ–∂–µ–π

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è REST API

1. **–£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ `/public` endpoints**
2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã API**
3. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
4. **–í—ã–Ω–µ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å–µ—Ä–≤–∏—Å—ã**
5. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** (pytest)
6. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Alembic** –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
7. **–î–æ–±–∞–≤–∏—Ç—å rate limiting**
8. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (structlog/loguru)

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- FastAPI Docs: https://fastapi.tiangolo.com/
- SQLAlchemy 2.0: https://docs.sqlalchemy.org/en/20/
- Pydantic: https://docs.pydantic.dev/

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-27
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 1.0.0



